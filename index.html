<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.330">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Iman Mousavi">
<meta name="dcterms.date" content="2023-06-20">

<title>Doctors Segmentation in Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sections</h2>
   
  <ul>
  <li><a href="#main-objective-of-the-project" id="toc-main-objective-of-the-project" class="nav-link active" data-scroll-target="#main-objective-of-the-project">Main Objective of the Project</a>
  <ul class="collapse">
  <li><a href="#can-you-find-a-better-way-to-segment-your-customers" id="toc-can-you-find-a-better-way-to-segment-your-customers" class="nav-link" data-scroll-target="#can-you-find-a-better-way-to-segment-your-customers">Can you find a better way to segment your customers?</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">📖 Background</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">💾 The data</a></li>
  <li><a href="#competition-challenge" id="toc-competition-challenge" class="nav-link" data-scroll-target="#competition-challenge">💪 Competition challenge</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#doctors-data" id="toc-doctors-data" class="nav-link" data-scroll-target="#doctors-data">Doctors Data</a></li>
  <li><a href="#orders-data" id="toc-orders-data" class="nav-link" data-scroll-target="#orders-data">Orders Data</a></li>
  <li><a href="#complaints-data" id="toc-complaints-data" class="nav-link" data-scroll-target="#complaints-data">Complaints Data</a></li>
  <li><a href="#instructions-data" id="toc-instructions-data" class="nav-link" data-scroll-target="#instructions-data">Instructions Data</a></li>
  <li><a href="#merged-data" id="toc-merged-data" class="nav-link" data-scroll-target="#merged-data">Merged Data</a></li>
  <li><a href="#missing-values" id="toc-missing-values" class="nav-link" data-scroll-target="#missing-values">Missing Values</a></li>
  <li><a href="#question-1" id="toc-question-1" class="nav-link" data-scroll-target="#question-1">Question 1</a></li>
  <li><a href="#question-2" id="toc-question-2" class="nav-link" data-scroll-target="#question-2">Question 2</a></li>
  <li><a href="#question-3" id="toc-question-3" class="nav-link" data-scroll-target="#question-3">Question 3</a>
  <ul class="collapse">
  <li><a href="#scaling-and-creation-of-dummies" id="toc-scaling-and-creation-of-dummies" class="nav-link" data-scroll-target="#scaling-and-creation-of-dummies">Scaling and Creation of Dummies</a></li>
  </ul></li>
  <li><a href="#satisfaction-imputation" id="toc-satisfaction-imputation" class="nav-link" data-scroll-target="#satisfaction-imputation">Satisfaction Imputation</a>
  <ul class="collapse">
  <li><a href="#imputation-with-knn" id="toc-imputation-with-knn" class="nav-link" data-scroll-target="#imputation-with-knn">Imputation with KNN</a></li>
  <li><a href="#imputation-with-iterative-imputation" id="toc-imputation-with-iterative-imputation" class="nav-link" data-scroll-target="#imputation-with-iterative-imputation">Imputation with Iterative Imputation</a></li>
  <li><a href="#comparing-two-imputations" id="toc-comparing-two-imputations" class="nav-link" data-scroll-target="#comparing-two-imputations">Comparing Two Imputations</a></li>
  </ul></li>
  <li><a href="#hierarchical-clustering" id="toc-hierarchical-clustering" class="nav-link" data-scroll-target="#hierarchical-clustering">Hierarchical Clustering</a>
  <ul class="collapse">
  <li><a href="#hierarchical-with-pca" id="toc-hierarchical-with-pca" class="nav-link" data-scroll-target="#hierarchical-with-pca">Hierarchical with PCA</a></li>
  </ul></li>
  <li><a href="#kmeans-clustering" id="toc-kmeans-clustering" class="nav-link" data-scroll-target="#kmeans-clustering">KMeans Clustering</a>
  <ul class="collapse">
  <li><a href="#kmeans-with-pca" id="toc-kmeans-with-pca" class="nav-link" data-scroll-target="#kmeans-with-pca">KMeans with PCA</a></li>
  </ul></li>
  <li><a href="#question-4-and-5" id="toc-question-4-and-5" class="nav-link" data-scroll-target="#question-4-and-5">Question 4 and 5</a>
  <ul class="collapse">
  <li><a href="#names-and-characteristics-of-doctors-segmentations" id="toc-names-and-characteristics-of-doctors-segmentations" class="nav-link" data-scroll-target="#names-and-characteristics-of-doctors-segmentations">Names and Characteristics of Doctors Segmentations</a></li>
  <li><a href="#names-of-clusters" id="toc-names-of-clusters" class="nav-link" data-scroll-target="#names-of-clusters">Names of Clusters</a></li>
  <li><a href="#targeted-groups" id="toc-targeted-groups" class="nav-link" data-scroll-target="#targeted-groups">Targeted Groups</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Doctors Segmentation in Python</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Iman Mousavi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 20, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>In this project, individual doctors are segmented into distinct groups as a part of marketing strategy process. First, Exploratory Data Analysis (EDA) helps to understand four data sets and their unique characteristics. After cleaning and making data tidy, cluster analysis algorithm is run to obtain segments, and Kernel PCA as a dimension reduction technique improves clustering as the final step.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="market-segmentation.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Market Segmentation</figcaption><p></p>
</figure>
</div>
<section id="main-objective-of-the-project" class="level1">
<h1>Main Objective of the Project</h1>
<section id="can-you-find-a-better-way-to-segment-your-customers" class="level2">
<h2 class="anchored" data-anchor-id="can-you-find-a-better-way-to-segment-your-customers">Can you find a better way to segment your customers?</h2>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">📖 Background</h3>
<p>You work for a medical device manufacturer in Switzerland. Your company manufactures orthopedic devices and sells them worldwide. The company sells directly to individual doctors who use them on rehabilitation and physical therapy patients.</p>
<p>Historically, the sales and customer support departments have grouped doctors by geography. However, the region is not a good predictor of the number of purchases a doctor will make or their support needs.</p>
<p>Your team wants to use a data-centric approach to segmenting doctors to improve marketing, customer service, and product planning.</p>
</section>
<section id="the-data" class="level3">
<h3 class="anchored" data-anchor-id="the-data">💾 The data</h3>
<p>The company stores the information you need in the following four tables. Some of the fields are anonymized to comply with privacy regulations.</p>
<section id="doctors-contains-information-on-doctors.-each-row-represents-one-doctor." class="level4">
<h4 class="anchored" data-anchor-id="doctors-contains-information-on-doctors.-each-row-represents-one-doctor.">Doctors contains information on doctors. Each row represents one doctor.</h4>
<ul>
<li>“DoctorID” - is a unique identifier for each doctor.</li>
<li>“Region” - the current geographical region of the doctor.</li>
<li>“Category” - the type of doctor, either ‘Specialist’ or ’General Practitioner.</li>
<li>“Rank” - is an internal ranking system. It is an ordered variable: The highest level is Ambassadors, followed by Titanium Plus, Titanium, Platinum Plus, Platinum, Gold Plus, Gold, Silver Plus, and the lowest level is Silver.</li>
<li>“Incidence rate” and “R rate” - relate to the amount of re-work each doctor generates.</li>
<li>“Satisfaction” - measures doctors’ satisfaction with the company.</li>
<li>“Experience” - relates to the doctor’s experience with the company.</li>
<li>“Purchases” - purchases over the last year.</li>
</ul>
</section>
<section id="orders-contains-details-on-orders.-each-row-represents-one-order-a-doctor-can-place-multiple-orders." class="level4">
<h4 class="anchored" data-anchor-id="orders-contains-details-on-orders.-each-row-represents-one-order-a-doctor-can-place-multiple-orders.">Orders contains details on orders. Each row represents one order; a doctor can place multiple orders.</h4>
<ul>
<li>“DoctorID” - doctor id (matches the other tables).</li>
<li>“OrderID” - order identifier.</li>
<li>“OrderNum” - order number.</li>
<li>“Conditions A through J” - map the different settings of the devices in each order. Each order goes to an individual patient.</li>
</ul>
</section>
<section id="complaints-collects-information-on-doctor-complaints." class="level4">
<h4 class="anchored" data-anchor-id="complaints-collects-information-on-doctor-complaints.">Complaints collects information on doctor complaints.</h4>
<ul>
<li>“DoctorID” - doctor id (matches the other tables).</li>
<li>“Complaint Type” - the company’s classification of the complaints.</li>
<li>“Qty” - number of complaints per complaint type per doctor.</li>
</ul>
</section>
<section id="instructions-has-information-on-whether-the-doctor-includes-special-instructions-on-their-orders." class="level4">
<h4 class="anchored" data-anchor-id="instructions-has-information-on-whether-the-doctor-includes-special-instructions-on-their-orders.">Instructions has information on whether the doctor includes special instructions on their orders.</h4>
<ul>
<li>“DoctorID” - doctor id (matches the other tables).</li>
<li>“Instructions” - ‘Yes’ when the doctor includes special instructions, ‘No’ when they do not.</li>
</ul>
</section>
</section>
<section id="competition-challenge" class="level3">
<h3 class="anchored" data-anchor-id="competition-challenge">💪 Competition challenge</h3>
<p>Create a report that covers the following:<br>
1. How many doctors are there in each region? What is the average number of purchases per region?<br>
2. Can you find a relationship between purchases and complaints?<br>
3. Define new doctor segments that help the company improve marketing efforts and customer service.<br>
4. Identify which features impact the new segmentation strategy the most.<br>
5. Your team will need to explain the new segments to the rest of the company. Describe which characteristics distinguish the newly defined segments.</p>
</section>
</section>
</section>
<section id="doctors-data" class="level1">
<h1>Doctors Data</h1>
<div class="cell" data-execution_count="3">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DoctorID</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Rank</th>
<th data-quarto-table-cell-role="th">Incidence rate</th>
<th data-quarto-table-cell-role="th">R rate</th>
<th data-quarto-table-cell-role="th">Satisfaction</th>
<th data-quarto-table-cell-role="th">Experience</th>
<th data-quarto-table-cell-role="th">Purchases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AHDCBA</td>
<td>4 15</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>49.0</td>
<td>0.90</td>
<td>53.85</td>
<td>1.20</td>
<td>49.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ABHAHF</td>
<td>1 8 T4</td>
<td>General Practitioner</td>
<td>Ambassador</td>
<td>37.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>38.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>FDHFJ</td>
<td>1 9 T4</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>33.0</td>
<td>1.53</td>
<td>--</td>
<td>0.00</td>
<td>34.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BJJHCA</td>
<td>1 10 T3</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>28.0</td>
<td>2.03</td>
<td>--</td>
<td>0.48</td>
<td>29.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>FJBEA</td>
<td>1 14 T4</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>23.0</td>
<td>0.96</td>
<td>76.79</td>
<td>0.75</td>
<td>24.0</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 437 entries, 0 to 436
Data columns (total 9 columns):
 #   Column          Non-Null Count  Dtype  
---  ------          --------------  -----  
 0   DoctorID        437 non-null    object 
 1   Region          437 non-null    object 
 2   Category        437 non-null    object 
 3   Rank            435 non-null    object 
 4   Incidence rate  437 non-null    float64
 5   R rate          437 non-null    float64
 6   Satisfaction    437 non-null    object 
 7   Experience      437 non-null    float64
 8   Purchases       437 non-null    float64
dtypes: float64(4), object(5)
memory usage: 30.9+ KB</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>None</code></pre>
</div>
</div>
<p>Satisfaction includes – values that should be converted into NaNs.</p>
<p>Rank is a categorical variable, like Region and Category</p>
<div class="cell" data-execution_count="5">
<div class="cell-output cell-output-stdout">
<pre><code>['Ambassador' 'Platinum Plus' 'Titanium' 'Silver Plus' 'Gold' 'Platinum'
 'Gold Plus' 'Silver' nan 'Titanium Plus']</code></pre>
</div>
</div>
<p>Satisfaction must be converted into float64:</p>
<p>Purchases as the name of the last column could be misleading as it refers to previous year.</p>
<p>Now, let’s check the changes:</p>
<div class="cell" data-execution_count="9">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DoctorID</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Rank</th>
<th data-quarto-table-cell-role="th">Incidence rate</th>
<th data-quarto-table-cell-role="th">R rate</th>
<th data-quarto-table-cell-role="th">Satisfaction</th>
<th data-quarto-table-cell-role="th">Experience</th>
<th data-quarto-table-cell-role="th">last_purchases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AHDCBA</td>
<td>4 15</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>49.0</td>
<td>0.90</td>
<td>53.85</td>
<td>1.20</td>
<td>49.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ABHAHF</td>
<td>1 8 T4</td>
<td>General Practitioner</td>
<td>Ambassador</td>
<td>37.0</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>38.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>FDHFJ</td>
<td>1 9 T4</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>33.0</td>
<td>1.53</td>
<td>NaN</td>
<td>0.00</td>
<td>34.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BJJHCA</td>
<td>1 10 T3</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>28.0</td>
<td>2.03</td>
<td>NaN</td>
<td>0.48</td>
<td>29.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>FJBEA</td>
<td>1 14 T4</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>23.0</td>
<td>0.96</td>
<td>76.79</td>
<td>0.75</td>
<td>24.0</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 437 entries, 0 to 436
Data columns (total 9 columns):
 #   Column          Non-Null Count  Dtype   
---  ------          --------------  -----   
 0   DoctorID        437 non-null    object  
 1   Region          437 non-null    category
 2   Category        437 non-null    category
 3   Rank            435 non-null    category
 4   Incidence rate  437 non-null    float64 
 5   R rate          437 non-null    float64 
 6   Satisfaction    250 non-null    float64 
 7   Experience      437 non-null    float64 
 8   last_purchases  437 non-null    float64 
dtypes: category(3), float64(5), object(1)
memory usage: 23.8+ KB</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>None</code></pre>
</div>
</div>
</section>
<section id="orders-data" class="level1">
<h1>Orders Data</h1>
<div class="cell" data-execution_count="10">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DoctorID</th>
<th data-quarto-table-cell-role="th">OrderID</th>
<th data-quarto-table-cell-role="th">OrderNum</th>
<th data-quarto-table-cell-role="th">Condition A</th>
<th data-quarto-table-cell-role="th">Condition B</th>
<th data-quarto-table-cell-role="th">Condition C</th>
<th data-quarto-table-cell-role="th">Condition D</th>
<th data-quarto-table-cell-role="th">Condition F</th>
<th data-quarto-table-cell-role="th">Condition G</th>
<th data-quarto-table-cell-role="th">Condition H</th>
<th data-quarto-table-cell-role="th">Condition I</th>
<th data-quarto-table-cell-role="th">Condition J</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ABJEAI</td>
<td>DGEJFDC</td>
<td>AIBEHCJ</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>True</td>
<td>False</td>
<td>Before</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>HBIEA</td>
<td>DGAJDAH</td>
<td>AIJIHGB</td>
<td>False</td>
<td>True</td>
<td>NaN</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>Before</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>GGCCD</td>
<td>DGBBDCB</td>
<td>AFEIHFB</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>EHHGF</td>
<td>DGCDCCF</td>
<td>AIBJJEE</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>Before</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>EHHGF</td>
<td>DGCFAGC</td>
<td>AEDBBDC</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 257 entries, 0 to 256
Data columns (total 12 columns):
 #   Column       Non-Null Count  Dtype 
---  ------       --------------  ----- 
 0   DoctorID     257 non-null    object
 1   OrderID      257 non-null    object
 2   OrderNum     257 non-null    object
 3   Condition A  257 non-null    bool  
 4   Condition B  257 non-null    bool  
 5   Condition C  248 non-null    object
 6   Condition D  257 non-null    bool  
 7   Condition F  254 non-null    object
 8   Condition G  254 non-null    object
 9   Condition H  257 non-null    bool  
 10  Condition I  257 non-null    bool  
 11  Condition J  149 non-null    object
dtypes: bool(5), object(7)
memory usage: 15.4+ KB</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>None</code></pre>
</div>
</div>
<p>Conditions C, F, G, and J are objects dtype.</p>
<div class="cell" data-execution_count="11">
<div class="cell-output cell-output-display">
<pre><code>0    False
1      NaN
2    False
3    False
4    False
Name: Condition C, dtype: object</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>array([False, nan, True], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DoctorID</th>
<th data-quarto-table-cell-role="th">OrderID</th>
<th data-quarto-table-cell-role="th">OrderNum</th>
<th data-quarto-table-cell-role="th">Condition A</th>
<th data-quarto-table-cell-role="th">Condition B</th>
<th data-quarto-table-cell-role="th">Condition C</th>
<th data-quarto-table-cell-role="th">Condition D</th>
<th data-quarto-table-cell-role="th">Condition F</th>
<th data-quarto-table-cell-role="th">Condition G</th>
<th data-quarto-table-cell-role="th">Condition H</th>
<th data-quarto-table-cell-role="th">Condition I</th>
<th data-quarto-table-cell-role="th">Condition J</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ABJEAI</td>
<td>DGEJFDC</td>
<td>AIBEHCJ</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>HBIEA</td>
<td>DGAJDAH</td>
<td>AIJIHGB</td>
<td>0</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>GGCCD</td>
<td>DGBBDCB</td>
<td>AFEIHFB</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>EHHGF</td>
<td>DGCDCCF</td>
<td>AIBJJEE</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>EHHGF</td>
<td>DGCFAGC</td>
<td>AEDBBDC</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>&lt;NA&gt;</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 257 entries, 0 to 256
Data columns (total 12 columns):
 #   Column       Non-Null Count  Dtype 
---  ------       --------------  ----- 
 0   DoctorID     257 non-null    object
 1   OrderID      257 non-null    object
 2   OrderNum     257 non-null    object
 3   Condition A  257 non-null    int64 
 4   Condition B  257 non-null    int64 
 5   Condition C  248 non-null    Int16 
 6   Condition D  257 non-null    int64 
 7   Condition F  254 non-null    Int16 
 8   Condition G  254 non-null    Int16 
 9   Condition H  257 non-null    int64 
 10  Condition I  257 non-null    int64 
 11  Condition J  149 non-null    Int16 
dtypes: Int16(4), int64(5), object(3)
memory usage: 19.2+ KB</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>None</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="cell-output cell-output-display">
<p>There are 257 records in orders data set. Number of unique DoctorID in order data set is 76 and the number of OrderID in that data set is 249. In other words, there are a few order cases that are duplicated and should be treated approporiatly.</p>
</div>
</div>
<p>The following dataframe shows duplicated cases in orders data set:</p>
<div class="cell" data-execution_count="15">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DoctorID</th>
<th data-quarto-table-cell-role="th">OrderID</th>
<th data-quarto-table-cell-role="th">OrderNum</th>
<th data-quarto-table-cell-role="th">Condition A</th>
<th data-quarto-table-cell-role="th">Condition B</th>
<th data-quarto-table-cell-role="th">Condition C</th>
<th data-quarto-table-cell-role="th">Condition D</th>
<th data-quarto-table-cell-role="th">Condition F</th>
<th data-quarto-table-cell-role="th">Condition G</th>
<th data-quarto-table-cell-role="th">Condition H</th>
<th data-quarto-table-cell-role="th">Condition I</th>
<th data-quarto-table-cell-role="th">Condition J</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>BCFJAB</td>
<td>DEIIFJB</td>
<td>AHFEGEI</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>BCFJAB</td>
<td>DEIIFJB</td>
<td>AHFEGEI</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>FJAJH</td>
<td>DGDIDFI</td>
<td>AIBECHD</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>FJAJH</td>
<td>DGDIDFI</td>
<td>AIBECHD</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">65</td>
<td>IFDIB</td>
<td>DGJECBF</td>
<td>AIJGEBJ</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">66</td>
<td>IFDIB</td>
<td>DGJECBF</td>
<td>AIJGEBJ</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">80</td>
<td>BCGFDD</td>
<td>DGIJDHB</td>
<td>AEFEHBC</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">81</td>
<td>BCGFDD</td>
<td>DGIJDHB</td>
<td>AEFEHBC</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">146</td>
<td>FAGIE</td>
<td>DGAGDHB</td>
<td>AFAGEGI</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">147</td>
<td>FAGIE</td>
<td>DGAGDHB</td>
<td>AFAGEGI</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">211</td>
<td>AAAEAH</td>
<td>DFHACJH</td>
<td>AECDDAD</td>
<td>0</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">212</td>
<td>AAAEAH</td>
<td>DFHACJH</td>
<td>AECDDAD</td>
<td>0</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">231</td>
<td>BBCHEH</td>
<td>DGDADIB</td>
<td>AIBBHED</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">232</td>
<td>BBCHEH</td>
<td>DGDADIB</td>
<td>AIBBHED</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">254</td>
<td>FJFEG</td>
<td>DGEABGI</td>
<td>AIBFJHE</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">255</td>
<td>FJFEG</td>
<td>DGEABGI</td>
<td>AIBFJHE</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We have to decide whether to keep the first or the second duplicated case. According to the next plot, most cases have had 0 or 1 conditions, so we go on with the first cases as they have just one condition too.</p>
<div class="cell" data-execution_count="16">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-17-output-1.png" width="593" height="429"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>Each doctor may placed several orders due to the fact that some DoctorIDs are repetitive but with different OrderIDs. To have a data set with unique DoctorIDs, we aggregate order conditions so that each row in this dataframe is representing one doctor with orders that could have multiple conditions.</p>
<div class="cell" data-execution_count="18">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DoctorID</th>
<th data-quarto-table-cell-role="th">Condition A</th>
<th data-quarto-table-cell-role="th">Condition B</th>
<th data-quarto-table-cell-role="th">Condition C</th>
<th data-quarto-table-cell-role="th">Condition D</th>
<th data-quarto-table-cell-role="th">Condition F</th>
<th data-quarto-table-cell-role="th">Condition G</th>
<th data-quarto-table-cell-role="th">Condition H</th>
<th data-quarto-table-cell-role="th">Condition I</th>
<th data-quarto-table-cell-role="th">Condition J</th>
<th data-quarto-table-cell-role="th">total_settings</th>
<th data-quarto-table-cell-role="th">total_orders</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AAAEAH</td>
<td>3</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>0</td>
<td>11.0</td>
<td>18</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AABDHC</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1.0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>AABGAB</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>5.0</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>AADDIG</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>AAEIEG</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>4.0</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">71</td>
<td>HCBFF</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1.0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">72</td>
<td>HCIGF</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2.0</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">73</td>
<td>HJDFA</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2.0</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">74</td>
<td>IAEBD</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75</td>
<td>IFDIB</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>5.0</td>
<td>4</td>
</tr>
</tbody>
</table>

<p>76 rows × 12 columns</p>
</div>
</div>
</div>
<p>Now, let’s take a look into orders dataframe to see how doctors orders are distributed.</p>
<div class="cell" data-execution_count="19">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-20-output-1.png" width="585" height="429"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-20-output-2.png" width="606" height="429"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
</section>
<section id="complaints-data" class="level1">
<h1>Complaints Data</h1>
<div class="cell" data-execution_count="20">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DoctorID</th>
<th data-quarto-table-cell-role="th">Complaint Type</th>
<th data-quarto-table-cell-role="th">Qty</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>EHAHI</td>
<td>Correct</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>EHDGF</td>
<td>Correct</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>EHDGF</td>
<td>Unknown</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>EHDIJ</td>
<td>Correct</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>EHDIJ</td>
<td>Incorrect</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 435 entries, 0 to 434
Data columns (total 3 columns):
 #   Column          Non-Null Count  Dtype 
---  ------          --------------  ----- 
 0   DoctorID        435 non-null    object
 1   Complaint Type  433 non-null    object
 2   Qty             435 non-null    int64 
dtypes: int64(1), object(2)
memory usage: 10.3+ KB</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>None</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="cell-output cell-output-display">
<p>Complaints data set has 2 in Complaint Type column. We can drop both safely.</p>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="cell-output cell-output-display">
<p>Number of unique DoctorIDs in complaints data is 284 and the number of cases in this data set is 433. Therefore, some doctors have had more than one complaints.</p>
</div>
</div>
<p>To have a complaints data set with unique DoctorIDs we change the shape to the following:</p>
<div class="cell" data-execution_count="23">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DoctorID</th>
<th data-quarto-table-cell-role="th">Correct</th>
<th data-quarto-table-cell-role="th">Incorrect</th>
<th data-quarto-table-cell-role="th">R&amp;R</th>
<th data-quarto-table-cell-role="th">Specific</th>
<th data-quarto-table-cell-role="th">Unknown</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AAAEAH</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AAAHCE</td>
<td>1</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>AABDHC</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>AABGAB</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>AACCGA</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">279</td>
<td>IEHGF</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">280</td>
<td>IEJIA</td>
<td>3</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">281</td>
<td>IFBHI</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">282</td>
<td>IFDIB</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">283</td>
<td>IGEIJ</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>284 rows × 6 columns</p>
</div>
</div>
</div>
<p>Let’s see how many complaints exist in each type:</p>
<div class="cell" data-execution_count="24">
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>Correct      451
Incorrect    173
R&amp;R            1
Specific       8
Unknown      145
dtype: int64</code></pre>
</div>
</div>
<p>Finally, a new feature is create to indicate the total number of complaints each doctor has made.</p>
</section>
<section id="instructions-data" class="level1">
<h1>Instructions Data</h1>
<div class="cell" data-execution_count="26">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DoctorID</th>
<th data-quarto-table-cell-role="th">Instructions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ADIFBD</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ABHBED</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>FJFEG</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>AEBDAB</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>AJCBFE</td>
<td>Yes</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 77 entries, 0 to 76
Data columns (total 2 columns):
 #   Column        Non-Null Count  Dtype 
---  ------        --------------  ----- 
 0   DoctorID      77 non-null     object
 1   Instructions  77 non-null     object
dtypes: object(2)
memory usage: 1.3+ KB</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>None</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="cell-output cell-output-display">
<p>Number of unique DoctorIDs in instruction data is 77 and the number of cases in this data set is 77. In other words, there are no duplicated instructions.</p>
</div>
</div>
</section>
<section id="merged-data" class="level1">
<h1>Merged Data</h1>
<div class="cell" data-execution_count="29">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DoctorID</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Rank</th>
<th data-quarto-table-cell-role="th">Incidence rate</th>
<th data-quarto-table-cell-role="th">R rate</th>
<th data-quarto-table-cell-role="th">Satisfaction</th>
<th data-quarto-table-cell-role="th">Experience</th>
<th data-quarto-table-cell-role="th">last_purchases</th>
<th data-quarto-table-cell-role="th">Condition A</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Condition J</th>
<th data-quarto-table-cell-role="th">total_settings</th>
<th data-quarto-table-cell-role="th">total_orders</th>
<th data-quarto-table-cell-role="th">Correct</th>
<th data-quarto-table-cell-role="th">Incorrect</th>
<th data-quarto-table-cell-role="th">R&amp;R</th>
<th data-quarto-table-cell-role="th">Specific</th>
<th data-quarto-table-cell-role="th">Unknown</th>
<th data-quarto-table-cell-role="th">total_complaints</th>
<th data-quarto-table-cell-role="th">Instructions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AHDCBA</td>
<td>4 15</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>49.00</td>
<td>0.90</td>
<td>53.85</td>
<td>1.20</td>
<td>49.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ABHAHF</td>
<td>1 8 T4</td>
<td>General Practitioner</td>
<td>Ambassador</td>
<td>37.00</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
<td>38.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>FDHFJ</td>
<td>1 9 T4</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>33.00</td>
<td>1.53</td>
<td>NaN</td>
<td>0.00</td>
<td>34.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BJJHCA</td>
<td>1 10 T3</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>28.00</td>
<td>2.03</td>
<td>NaN</td>
<td>0.48</td>
<td>29.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>FJBEA</td>
<td>1 14 T4</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>23.00</td>
<td>0.96</td>
<td>76.79</td>
<td>0.75</td>
<td>24.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">432</td>
<td>AIABDJ</td>
<td>1 10</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>2.18</td>
<td>0.80</td>
<td>11.76</td>
<td>0.77</td>
<td>35.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">433</td>
<td>BBAJCF</td>
<td>1 9 T4</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>2.17</td>
<td>1.68</td>
<td>NaN</td>
<td>0.11</td>
<td>19.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">434</td>
<td>GGCFB</td>
<td>1 19 T4</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>2.14</td>
<td>0.77</td>
<td>NaN</td>
<td>0.27</td>
<td>22.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">435</td>
<td>FDCEG</td>
<td>1 9</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>2.13</td>
<td>0.84</td>
<td>100.00</td>
<td>0.32</td>
<td>25.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">436</td>
<td>EIEIB</td>
<td>1 13</td>
<td>Specialist</td>
<td>Ambassador</td>
<td>2.05</td>
<td>1.56</td>
<td>11.11</td>
<td>0.39</td>
<td>64.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

<p>437 rows × 27 columns</p>
</div>
</div>
</div>
</section>
<section id="missing-values" class="level1">
<h1>Missing Values</h1>
<div class="cell" data-execution_count="30">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-31-output-1.png" width="808" height="887"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-31-output-3.png" width="789" height="849"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>There are two cases in which Rank column has no information and it is acceptable to consider such missings MCAR (Missing Completely at Random). The best thing we can do here is to omit both of them.</p>
<p>Lets see if we can find out any relationship between other variables and missing values in <code>Satisfaction</code> field.</p>
<div class="cell" data-execution_count="32">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-33-output-1.png" width="597" height="429"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-33-output-2.png" width="597" height="429"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-33-output-3.png" width="589" height="429"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-33-output-4.png" width="606" height="429"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-33-output-5.png" width="597" height="429"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>These plots suggest no pattern either. However, we intend to impute missing values with multiple imputation technique using miclust package in R.</p>
</section>
<section id="question-1" class="level1">
<h1>Question 1</h1>
<p>First, we group data by Region column then aggregate doctors data set to get the answer. In the next plot, the number of doctors and the average purchases in each region are demonstrated.</p>
<div class="cell" data-execution_count="33">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-34-output-1.png" width="767" height="725"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-35-output-1.png" width="767" height="725"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
</section>
<section id="question-2" class="level1">
<h1>Question 2</h1>
<div class="cell" data-execution_count="35">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-36-output-1.png" width="589" height="427"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-37-output-1.png" width="596" height="427"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-38-output-1.png" width="596" height="427"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>Figures shown in above suggest number of purchases of a doctor decreases when they send their complaints to the company. This relationship is slightly more obvious if doctors complaints have been accepted by the company compared with the cases in which their complaints were not correct.</p>
</section>
<section id="question-3" class="level1">
<h1>Question 3</h1>
<section id="scaling-and-creation-of-dummies" class="level2">
<h2 class="anchored" data-anchor-id="scaling-and-creation-of-dummies">Scaling and Creation of Dummies</h2>
<p>Clustering methods require to have an scaled and numeric data as inputs. To satisfy such constraints, we use functions from sklearn and pandas package in this section.</p>
</section>
</section>
<section id="satisfaction-imputation" class="level1">
<h1>Satisfaction Imputation</h1>
<section id="imputation-with-knn" class="level2">
<h2 class="anchored" data-anchor-id="imputation-with-knn">Imputation with KNN</h2>
<p>First few rows of imputed satisfaction column with KNN method:</p>
<div class="cell" data-execution_count="39">
<div class="cell-output cell-output-display">
<pre><code>0     53.850
1    100.000
2     88.395
3     88.395
4     76.790
Name: Satisfaction, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="imputation-with-iterative-imputation" class="level2">
<h2 class="anchored" data-anchor-id="imputation-with-iterative-imputation">Imputation with Iterative Imputation</h2>
<p>First few rows of imputed satisfaction column with Iterative method:</p>
</section>
<section id="comparing-two-imputations" class="level2">
<h2 class="anchored" data-anchor-id="comparing-two-imputations">Comparing Two Imputations</h2>
<p>Itarative Imputation predicted extreme values of satisfaction, which is not acceptable for our analysis. Also, the difference between peaks of imputed and observed values in KNN model is less than that of Iterative algorithm. We continue with imputed satisfaction generated by the KNN model.</p>
</section>
</section>
<section id="hierarchical-clustering" class="level1">
<h1>Hierarchical Clustering</h1>
<p>Dendrogram plot demonstrates how far two clusters are before their integration into one. In other words, if two clusters are too far from each other, their vertical line showing distance is bigger. It’s recommended that the analyst cut the tree in a distance in which so many dissimilarities are not ignored.</p>
<p><strong>Here, the dendrogram proposes 3 clusters.</strong></p>
<div class="cell" data-execution_count="44">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-45-output-1.png" width="567" height="409"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>The plots shown here are attempting to distinguish segments the hierarchical clustering has generated. In case the vital metrics differ in a meaningful manner, we succeed in our segmentation. Otherwise, we must continue working on the algorithm and data to get a better result.</p>
<p>Dot plots represent averages in each group alongside a vertical bar that can be interpreted as uncertainty. The more variance or standard deviation of the mean, the longer the vertical bar.</p>
<div class="cell" data-execution_count="45">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-46-output-1.png" width="589" height="427"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-46-output-3.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-46-output-5.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-46-output-7.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-46-output-9.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-46-output-11.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-46-output-13.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>Results are not satisfactory, so it’s a good idea to reduce the number of features or dimensions since cluster analysis works better with more informed components.</p>
<section id="hierarchical-with-pca" class="level2">
<h2 class="anchored" data-anchor-id="hierarchical-with-pca">Hierarchical with PCA</h2>
<p>Principal Component Analysis is a popular algorithm that aims to reduce the number of features or dimensions in a dataframe. One of the most beneficial outcome of this method is that we can identify lower number of features explaining the most part of variance in a data set. This would help to get the most compact useful information leading to a practical segmentation. The following results have been obtained after PCA is applied to the merged data set of individual doctors.</p>
<p><strong>Here, the dendrogram proposes 6 clusters.</strong></p>
<div class="cell" data-execution_count="47">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-48-output-1.png" width="559" height="409"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-49-output-1.png" width="589" height="427"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-49-output-3.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-49-output-5.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-49-output-7.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-49-output-9.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-49-output-11.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-49-output-13.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="kmeans-clustering" class="level1">
<h1>KMeans Clustering</h1>
<p>This algorithm is another option that can be used for clustering. However, since the number of clusters must be given to the function in order to start manipulating centroids to get the best result, we create a loop in which different numbers go into the function and with the elbow plot we try to detect the finest number of clusters. In elbow plot, the distance between a centroid and the observations around it is calculated (distorsion). In case an additional centroid or cluster doesn’t reduce distorsions to the previous rate, we stop searching and select the number before the last one.</p>
<div class="cell" data-execution_count="49">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-50-output-1.png" width="585" height="427"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>Using all the features sounds not a good idea since the elbow plot has no suggestion for the number of clusters. PCA could enhance our algorithm because it takes into account only those components that have the most variance.</p>
<section id="kmeans-with-pca" class="level3">
<h3 class="anchored" data-anchor-id="kmeans-with-pca">KMeans with PCA</h3>
<div class="cell" data-execution_count="50">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-51-output-1.png" width="593" height="427"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>This plot also confirms that 6 clusters is an appropriate number of clusters in our case.</p>
</section>
</section>
<section id="question-4-and-5" class="level1">
<h1>Question 4 and 5</h1>
<section id="names-and-characteristics-of-doctors-segmentations" class="level2">
<h2 class="anchored" data-anchor-id="names-and-characteristics-of-doctors-segmentations">Names and Characteristics of Doctors Segmentations</h2>
<p>In this section, each cluster is attempted to be described with the features given in the data.</p>
<p>First things first, let’s take a look for one more time to the number of individuals in each cluster.</p>
<div class="cell" data-execution_count="51">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Cluster Group</th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>40</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>85</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>90</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>67</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>47</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>6</td>
<td>106</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Group 6 has the highest number of individuals followed by group 3 and 2. Group 1 has the lowest population.</p>
<p>Next, due to the importance of customer satisfaction in every business, the following plot shows how satisfaction is distributed among 6 groups.</p>
<div class="cell" data-execution_count="53">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-54-output-1.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>Doctors in group 3 are more satisfied customers of the company in average and the error bar is relatively low. In the second place, group 6 contains comparitively satisfied doctors. On the other hand, group 6 and group 1 are not very satisfied in average, but the error bars are larger than the others. In group 1 specifically, there are a wide range of satisfaction as the error bar length is considerable.</p>
<p>Experience column can detect which customers have been working with the company longer and which of them have purchased recently.</p>
<div class="cell" data-execution_count="54">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-55-output-1.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>Doctors of group 2 have more experience followed by group 1. Differences among other groups are not so strong.</p>
<p>The next two figures show the average of Incident Rate and R Rate (Rework) for each cluster group.</p>
<p>Although Group 1 has the lowest rework rate, other cluster groups have no meaningful difference. Incident rate, however, has a large value for group 2 and 6, with a lower standard deviation for the latter.</p>
<div class="cell" data-execution_count="55">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-56-output-1.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="56">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-57-output-1.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>In the next plot, you can see the average number of purchases in each cluster. Group 3 and 2 have purchased more (group 3 has lower uncertainty) and Group 1, 4, and 5 haven’t chosen the company for supply.</p>
<div class="cell" data-execution_count="57">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-58-output-1.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>Also, the average number of settings that customers demanded along their orders matters. Group 2 on average, are more detailed for their order.</p>
<div class="cell" data-execution_count="58">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-59-output-1.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>Group 2 are complaining more than any other group as the next dot plot shows.</p>
<div class="cell" data-execution_count="59">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-60-output-1.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>Groups 2 and 3 have had more instructions relatively.</p>
<div class="cell" data-execution_count="60">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-61-output-1.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<p>Finally, group 2 have placed more orders recently implying they are more interested to buy from the company. In other words, the company should put their energy into luring them. Marketing activities should revolve aroung such customers with their specific characteristics.</p>
<div class="cell" data-execution_count="61">
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-62-output-1.png" width="470" height="470"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
</section>
<section id="names-of-clusters" class="level2">
<h2 class="anchored" data-anchor-id="names-of-clusters">Names of Clusters</h2>
<p>Group 1 haven’t purchased that much compared to others and their satisfaction are so volatile meaning that some of doctors have been delighted and some have been unsatisfied. Their incident rate and rework rate are low, which is a cost privilege for the company. Their size is not that significant though.</p>
<p><strong>Group 1 is named “Easy-goings Doctors”</strong></p>
<p>Group 2 have more experience with the products of the company. However, their incident rate and rework are high. These customers have already purchased last year almost 13 times. They have complained more than others partially because of their high number of purchases. The instructions they need are also more significant. Most orders in this year comes from group 2.</p>
<p><strong>Group 2 is named “Picking Loyal Doctors”</strong></p>
<p>Group 3 consist of customers with the most purchases from last year, but their orders for this year has dropped to almost zero. They’ve been more satisfied group with past experience. They didn’t complain of their purchases, so it’s a mystery why they’ve stopped buying from the company. More investigation is required in order to explain the reasons underlying their reluctance.</p>
<p><strong>Group 3 is named “Mysterious Doctors”</strong></p>
<p>Group 4 contains doctors who are happy with their previous purchases, but in general, they don’t have much experience and their purchases in the last year was trivial. This group has some orders this year.</p>
<p><strong>Group 4 is named “Curious Doctors”</strong></p>
<p>Group 5 doctors have the least experience with the lowest satisfaction rate. They haven’t bought last year so we are almost confident we can ignore this segment of doctors. The number of doctors in this group is negligible too.</p>
<p><strong>Group 5 is named “Ignored Doctors”</strong></p>
<p>Group 6 include doctors who are the happiest with their previous purchases after group 3. Instructions in this group is low comparing to others, but their incident rate is rather high. Doctors in this group have placed some orders too. The majority of doctors have been categorized in this group.</p>
<p><strong>Group 6 is named “Promising Doctors”</strong></p>
</section>
<section id="targeted-groups" class="level2">
<h2 class="anchored" data-anchor-id="targeted-groups">Targeted Groups</h2>
<p>In conclusion, the company should focus on group 6 with the intention of converting them into regular customers. Group 2 includes the most royal customers whose satisfaction is a priority. Group 3 is also important regarding the fact that they can be transformed from inactive customers to active ones. Groups 1 and 4 can be treated with less attention and group 5 should be left out.</p>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb55" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Doctors Segmentation in Python"</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Iman Mousavi"</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co">    css: styles.css</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2023-06-20"</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: false</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: false</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="an">toccolor:</span><span class="co"> "#023E8A"</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="an">toc-title:</span><span class="co"> Sections</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="an">theme:</span><span class="co"> theme.scss</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="an">code-link:</span><span class="co"> true</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="an">code-fold:</span><span class="co"> show</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a><span class="an">code-tools:</span><span class="co"> true</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a><span class="an">highlight-style:</span><span class="co"> github</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>In this project, individual doctors are segmented into distinct groups as a part of marketing strategy process. First, Exploratory Data Analysis (EDA) helps to understand four data sets and their unique characteristics. After cleaning and making data tidy, cluster analysis algorithm is run to obtain segments, and Kernel PCA as a dimension reduction technique improves clustering as the final step.</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a><span class="al">![Market Segmentation](market-segmentation.png)</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a><span class="fu"># Main Objective of the Project</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## Can you find a better way to segment your customers?</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a><span class="fu">### 📖 Background</span></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>You work for a medical device manufacturer in Switzerland. Your company manufactures orthopedic devices and sells them worldwide. The company sells directly to individual doctors who use them on rehabilitation and physical therapy patients.</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>Historically, the sales and customer support departments have grouped doctors by geography. However, the region is not a good predictor of the number of purchases a doctor will make or their support needs.</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>Your team wants to use a data-centric approach to segmenting doctors to improve marketing, customer service, and product planning.</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a><span class="fu">### 💾 The data</span></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>The company stores the information you need in the following four tables. Some of the fields are anonymized to comply with privacy regulations.</span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Doctors contains information on doctors. Each row represents one doctor.</span></span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"DoctorID" - is a unique identifier for each doctor.</span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Region" - the current geographical region of the doctor.</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Category" - the type of doctor, either 'Specialist' or 'General Practitioner.</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Rank" - is an internal ranking system. It is an ordered variable: The highest level is Ambassadors, followed by Titanium Plus, Titanium, Platinum Plus, Platinum, Gold Plus, Gold, Silver Plus, and the lowest level is Silver.</span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Incidence rate" and "R rate" - relate to the amount of re-work each doctor generates.</span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Satisfaction" - measures doctors' satisfaction with the company.</span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Experience" - relates to the doctor's experience with the company.</span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Purchases" - purchases over the last year.</span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Orders contains details on orders. Each row represents one order; a doctor can place multiple orders.</span></span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"DoctorID" - doctor id (matches the other tables).</span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"OrderID" - order identifier.</span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"OrderNum" - order number.</span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Conditions A through J" - map the different settings of the devices in each order. Each order goes to an individual patient.</span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Complaints collects information on doctor complaints.</span></span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"DoctorID" - doctor id (matches the other tables).</span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Complaint Type" - the company's classification of the complaints.</span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Qty" - number of complaints per complaint type per doctor.</span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Instructions has information on whether the doctor includes special instructions on their orders.</span></span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"DoctorID" - doctor id (matches the other tables).</span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Instructions" - 'Yes' when the doctor includes special instructions, 'No' when they do not.</span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a><span class="fu">### 💪 Competition challenge</span></span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a>Create a report that covers the following:\</span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>How many doctors are there in each region? What is the average number of purchases per region?\</span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Can you find a relationship between purchases and complaints?\</span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Define new doctor segments that help the company improve marketing efforts and customer service.\</span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Identify which features impact the new segmentation strategy the most.\</span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Your team will need to explain the new segments to the rest of the company. Describe which characteristics distinguish the newly defined segments.</span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a><span class="fu"># Doctors Data</span></span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Libraries}</span></span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.api.types <span class="im">import</span> CategoricalDtype</span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> missingno <span class="im">as</span> msno</span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> KNNImputer</span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, Markdown</span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.experimental <span class="im">import</span> enable_iterative_imputer</span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> IterativeImputer</span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> KernelPCA</span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.cluster.hierarchy <span class="im">import</span> linkage, fcluster, dendrogram</span>
<span id="cb55-98"><a href="#cb55-98" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.cluster.vq <span class="im">import</span> kmeans, vq</span>
<span id="cb55-99"><a href="#cb55-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-100"><a href="#cb55-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-101"><a href="#cb55-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Import Data}</span></span>
<span id="cb55-102"><a href="#cb55-102" aria-hidden="true" tabindex="-1"></a>doctors <span class="op">=</span> pd.read_csv(<span class="st">'doctors.csv'</span>)</span>
<span id="cb55-103"><a href="#cb55-103" aria-hidden="true" tabindex="-1"></a>orders <span class="op">=</span> pd.read_csv(<span class="st">'orders.csv'</span>)</span>
<span id="cb55-104"><a href="#cb55-104" aria-hidden="true" tabindex="-1"></a>complaints <span class="op">=</span> pd.read_csv(<span class="st">'complaints.csv'</span>)</span>
<span id="cb55-105"><a href="#cb55-105" aria-hidden="true" tabindex="-1"></a>instruction <span class="op">=</span> pd.read_csv(<span class="st">'instructions.csv'</span>)</span>
<span id="cb55-106"><a href="#cb55-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-107"><a href="#cb55-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-108"><a href="#cb55-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Checking Doctors Data}</span></span>
<span id="cb55-109"><a href="#cb55-109" aria-hidden="true" tabindex="-1"></a>display(doctors.head())</span>
<span id="cb55-110"><a href="#cb55-110" aria-hidden="true" tabindex="-1"></a>display(doctors.info())</span>
<span id="cb55-111"><a href="#cb55-111" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-112"><a href="#cb55-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-113"><a href="#cb55-113" aria-hidden="true" tabindex="-1"></a>Satisfaction includes -- values that should be converted into NaNs.</span>
<span id="cb55-114"><a href="#cb55-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-115"><a href="#cb55-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Replacing -- with NaNs}</span></span>
<span id="cb55-116"><a href="#cb55-116" aria-hidden="true" tabindex="-1"></a>doctors.replace({<span class="st">'--'</span>:np.nan}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-117"><a href="#cb55-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-118"><a href="#cb55-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-119"><a href="#cb55-119" aria-hidden="true" tabindex="-1"></a>Rank is a categorical variable, like Region and Category</span>
<span id="cb55-120"><a href="#cb55-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-121"><a href="#cb55-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Transforming Rank into Categorical Data}</span></span>
<span id="cb55-122"><a href="#cb55-122" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(doctors[<span class="st">'Rank'</span>].unique())</span>
<span id="cb55-123"><a href="#cb55-123" aria-hidden="true" tabindex="-1"></a>cat_type <span class="op">=</span> CategoricalDtype(categories<span class="op">=</span>[<span class="st">'Silver'</span>, <span class="st">'Silver Plus'</span>,</span>
<span id="cb55-124"><a href="#cb55-124" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'Gold'</span>, <span class="st">'Gold Plus'</span>, <span class="st">'Platinum'</span>,</span>
<span id="cb55-125"><a href="#cb55-125" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'Platinum Plus'</span>, <span class="st">'Titanium'</span>,</span>
<span id="cb55-126"><a href="#cb55-126" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'Titanium Plus'</span>, <span class="st">'Ambassador'</span>],</span>
<span id="cb55-127"><a href="#cb55-127" aria-hidden="true" tabindex="-1"></a>                                         ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-128"><a href="#cb55-128" aria-hidden="true" tabindex="-1"></a>doctors[<span class="st">'Rank'</span>] <span class="op">=</span> doctors[<span class="st">'Rank'</span>].astype(cat_type)</span>
<span id="cb55-129"><a href="#cb55-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-130"><a href="#cb55-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-131"><a href="#cb55-131" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Transforming Category Region into Categorical Data}</span></span>
<span id="cb55-132"><a href="#cb55-132" aria-hidden="true" tabindex="-1"></a>doctors[<span class="st">'Category'</span>] <span class="op">=</span> doctors[<span class="st">'Category'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb55-133"><a href="#cb55-133" aria-hidden="true" tabindex="-1"></a>doctors[<span class="st">'Region'</span>] <span class="op">=</span> doctors[<span class="st">'Region'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb55-134"><a href="#cb55-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-135"><a href="#cb55-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-136"><a href="#cb55-136" aria-hidden="true" tabindex="-1"></a>Satisfaction must be converted into float64:</span>
<span id="cb55-137"><a href="#cb55-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-138"><a href="#cb55-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Satisfaction as Float64}</span></span>
<span id="cb55-139"><a href="#cb55-139" aria-hidden="true" tabindex="-1"></a>doctors[<span class="st">'Satisfaction'</span>] <span class="op">=</span> doctors[<span class="st">'Satisfaction'</span>].astype(<span class="st">'float64'</span>)</span>
<span id="cb55-140"><a href="#cb55-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-141"><a href="#cb55-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-142"><a href="#cb55-142" aria-hidden="true" tabindex="-1"></a>Purchases as the name of the last column could be misleading as it refers to previous year.</span>
<span id="cb55-143"><a href="#cb55-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-144"><a href="#cb55-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Purchases Name}</span></span>
<span id="cb55-145"><a href="#cb55-145" aria-hidden="true" tabindex="-1"></a>doctors.rename({<span class="st">'Purchases'</span>:<span class="st">'last_purchases'</span>}, inplace <span class="op">=</span> <span class="va">True</span>, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb55-146"><a href="#cb55-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-147"><a href="#cb55-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-148"><a href="#cb55-148" aria-hidden="true" tabindex="-1"></a>Now, let's check the changes:</span>
<span id="cb55-149"><a href="#cb55-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-150"><a href="#cb55-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Checking Doctors Data after DType Corrections}</span></span>
<span id="cb55-151"><a href="#cb55-151" aria-hidden="true" tabindex="-1"></a>display(doctors.head())</span>
<span id="cb55-152"><a href="#cb55-152" aria-hidden="true" tabindex="-1"></a>display(doctors.info())</span>
<span id="cb55-153"><a href="#cb55-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-154"><a href="#cb55-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-155"><a href="#cb55-155" aria-hidden="true" tabindex="-1"></a><span class="fu"># Orders Data</span></span>
<span id="cb55-156"><a href="#cb55-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-157"><a href="#cb55-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Checking Orders Data}</span></span>
<span id="cb55-158"><a href="#cb55-158" aria-hidden="true" tabindex="-1"></a>display(orders.head())</span>
<span id="cb55-159"><a href="#cb55-159" aria-hidden="true" tabindex="-1"></a>display(orders.info())</span>
<span id="cb55-160"><a href="#cb55-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-161"><a href="#cb55-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-162"><a href="#cb55-162" aria-hidden="true" tabindex="-1"></a>Conditions C, F, G, and J are objects dtype.</span>
<span id="cb55-163"><a href="#cb55-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-164"><a href="#cb55-164" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Condition C }</span></span>
<span id="cb55-165"><a href="#cb55-165" aria-hidden="true" tabindex="-1"></a>display(orders[<span class="st">'Condition C'</span>].head())</span>
<span id="cb55-166"><a href="#cb55-166" aria-hidden="true" tabindex="-1"></a>display(orders[<span class="st">'Condition C'</span>].unique())</span>
<span id="cb55-167"><a href="#cb55-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-168"><a href="#cb55-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-169"><a href="#cb55-169" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Replacing True and False with 0 and 1}</span></span>
<span id="cb55-170"><a href="#cb55-170" aria-hidden="true" tabindex="-1"></a>orders.replace({<span class="va">True</span>:<span class="dv">1</span>, <span class="va">False</span>:<span class="dv">0</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-171"><a href="#cb55-171" aria-hidden="true" tabindex="-1"></a>orders.replace({<span class="st">'Before'</span>:<span class="dv">0</span>, <span class="st">'After'</span>:<span class="dv">1</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-172"><a href="#cb55-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-173"><a href="#cb55-173" aria-hidden="true" tabindex="-1"></a>orders[<span class="st">'Condition C'</span>] <span class="op">=</span> orders[<span class="st">'Condition C'</span>].astype(<span class="st">'Int16'</span>)</span>
<span id="cb55-174"><a href="#cb55-174" aria-hidden="true" tabindex="-1"></a>orders[<span class="st">'Condition F'</span>] <span class="op">=</span> orders[<span class="st">'Condition F'</span>].astype(<span class="st">'Int16'</span>)</span>
<span id="cb55-175"><a href="#cb55-175" aria-hidden="true" tabindex="-1"></a>orders[<span class="st">'Condition G'</span>] <span class="op">=</span> orders[<span class="st">'Condition G'</span>].astype(<span class="st">'Int16'</span>)</span>
<span id="cb55-176"><a href="#cb55-176" aria-hidden="true" tabindex="-1"></a>orders[<span class="st">'Condition J'</span>] <span class="op">=</span> orders[<span class="st">'Condition J'</span>].astype(<span class="st">'Int16'</span>)</span>
<span id="cb55-177"><a href="#cb55-177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-178"><a href="#cb55-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-179"><a href="#cb55-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Checking Orders Data after Numerical Transformation}</span></span>
<span id="cb55-180"><a href="#cb55-180" aria-hidden="true" tabindex="-1"></a>display(orders.head())</span>
<span id="cb55-181"><a href="#cb55-181" aria-hidden="true" tabindex="-1"></a>display(orders.info())</span>
<span id="cb55-182"><a href="#cb55-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-183"><a href="#cb55-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-184"><a href="#cb55-184" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Unique DoctorID and OrderID}</span></span>
<span id="cb55-185"><a href="#cb55-185" aria-hidden="true" tabindex="-1"></a>doctorid_orders <span class="op">=</span> <span class="bu">len</span>(orders[<span class="st">'DoctorID'</span>].unique())</span>
<span id="cb55-186"><a href="#cb55-186" aria-hidden="true" tabindex="-1"></a>orderid_orders <span class="op">=</span> <span class="bu">len</span>(orders[<span class="st">'OrderID'</span>].unique())</span>
<span id="cb55-187"><a href="#cb55-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-188"><a href="#cb55-188" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="ss">f'There are </span><span class="sc">{</span>orders<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> records in orders data set. Number of unique DoctorID in order data set is </span><span class="sc">{</span>doctorid_orders<span class="sc">}</span><span class="ss"> and the number of OrderID in that data set is </span><span class="sc">{</span>orderid_orders<span class="sc">}</span><span class="ss">. In other words, there are a few order cases that are duplicated and should be treated approporiatly.'</span>))</span>
<span id="cb55-189"><a href="#cb55-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-190"><a href="#cb55-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-191"><a href="#cb55-191" aria-hidden="true" tabindex="-1"></a>The following dataframe shows duplicated cases in orders data set:</span>
<span id="cb55-192"><a href="#cb55-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-193"><a href="#cb55-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Duplicated Cases in Orders}</span></span>
<span id="cb55-194"><a href="#cb55-194" aria-hidden="true" tabindex="-1"></a>display(orders[orders.duplicated(subset <span class="op">=</span> <span class="st">'OrderID'</span>, keep <span class="op">=</span> <span class="va">False</span>)])</span>
<span id="cb55-195"><a href="#cb55-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-196"><a href="#cb55-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-197"><a href="#cb55-197" aria-hidden="true" tabindex="-1"></a>We have to decide whether to keep the first or the second duplicated case. According to the next plot, most cases have had 0 or 1 conditions, so we go on with the first cases as they have just one condition too.</span>
<span id="cb55-198"><a href="#cb55-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-199"><a href="#cb55-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Number of Conditions for each Order}</span></span>
<span id="cb55-200"><a href="#cb55-200" aria-hidden="true" tabindex="-1"></a>agg_conditions <span class="op">=</span> orders.loc[:, <span class="st">'Condition A'</span>:<span class="st">'Condition J'</span>]<span class="op">\</span></span>
<span id="cb55-201"><a href="#cb55-201" aria-hidden="true" tabindex="-1"></a>.<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>).astype(<span class="st">'category'</span>)</span>
<span id="cb55-202"><a href="#cb55-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-203"><a href="#cb55-203" aria-hidden="true" tabindex="-1"></a>agg_conditions_df <span class="op">=</span> pd.DataFrame({<span class="st">'agg_cond'</span>:agg_conditions})</span>
<span id="cb55-204"><a href="#cb55-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-205"><a href="#cb55-205" aria-hidden="true" tabindex="-1"></a>sns.countplot(x <span class="op">=</span> <span class="st">'agg_cond'</span>, data <span class="op">=</span> agg_conditions_df)</span>
<span id="cb55-206"><a href="#cb55-206" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-207"><a href="#cb55-207" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-208"><a href="#cb55-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-209"><a href="#cb55-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-210"><a href="#cb55-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Dropping Duplicated OrderIDs}</span></span>
<span id="cb55-211"><a href="#cb55-211" aria-hidden="true" tabindex="-1"></a>orders.drop_duplicates(subset <span class="op">=</span> [<span class="st">'OrderID'</span>], inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb55-212"><a href="#cb55-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-213"><a href="#cb55-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-214"><a href="#cb55-214" aria-hidden="true" tabindex="-1"></a>Each doctor may placed several orders due to the fact that some DoctorIDs are repetitive but with different OrderIDs. To have a data set with unique DoctorIDs, we aggregate order conditions so that each row in this dataframe is representing one doctor with orders that could have multiple conditions.</span>
<span id="cb55-215"><a href="#cb55-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-216"><a href="#cb55-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Orders Aggregated}</span></span>
<span id="cb55-217"><a href="#cb55-217" aria-hidden="true" tabindex="-1"></a>conditions <span class="op">=</span> orders.<span class="bu">filter</span>(like <span class="op">=</span> <span class="st">'Condition'</span>)</span>
<span id="cb55-218"><a href="#cb55-218" aria-hidden="true" tabindex="-1"></a>agg_orders <span class="op">=</span> orders.groupby(<span class="st">'DoctorID'</span>)[conditions.columns].<span class="bu">sum</span>()<span class="op">\</span></span>
<span id="cb55-219"><a href="#cb55-219" aria-hidden="true" tabindex="-1"></a>.reset_index()</span>
<span id="cb55-220"><a href="#cb55-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-221"><a href="#cb55-221" aria-hidden="true" tabindex="-1"></a>agg_orders[<span class="st">'total_settings'</span>] <span class="op">=</span> agg_orders.loc[:,<span class="st">'Condition A'</span>:<span class="st">'Condition J'</span>].<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb55-222"><a href="#cb55-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-223"><a href="#cb55-223" aria-hidden="true" tabindex="-1"></a>agg_orders[<span class="st">'total_orders'</span>] <span class="op">=</span> orders.groupby(<span class="st">'DoctorID'</span>)[<span class="st">'OrderID'</span>].size().values</span>
<span id="cb55-224"><a href="#cb55-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-225"><a href="#cb55-225" aria-hidden="true" tabindex="-1"></a>display(agg_orders)</span>
<span id="cb55-226"><a href="#cb55-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-227"><a href="#cb55-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-228"><a href="#cb55-228" aria-hidden="true" tabindex="-1"></a>Now, let's take a look into orders dataframe to see how doctors orders are distributed.</span>
<span id="cb55-229"><a href="#cb55-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-230"><a href="#cb55-230" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Orders Distribution}</span></span>
<span id="cb55-231"><a href="#cb55-231" aria-hidden="true" tabindex="-1"></a>sns.countplot(x <span class="op">=</span> <span class="st">'total_orders'</span>, data <span class="op">=</span> agg_orders)</span>
<span id="cb55-232"><a href="#cb55-232" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-233"><a href="#cb55-233" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-234"><a href="#cb55-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-235"><a href="#cb55-235" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x <span class="op">=</span> <span class="st">'total_orders'</span>, data <span class="op">=</span> agg_orders)</span>
<span id="cb55-236"><a href="#cb55-236" aria-hidden="true" tabindex="-1"></a>sns.rugplot(x <span class="op">=</span> <span class="st">'total_orders'</span>, data <span class="op">=</span> agg_orders)</span>
<span id="cb55-237"><a href="#cb55-237" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-238"><a href="#cb55-238" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-239"><a href="#cb55-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-240"><a href="#cb55-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-241"><a href="#cb55-241" aria-hidden="true" tabindex="-1"></a><span class="fu"># Complaints Data</span></span>
<span id="cb55-242"><a href="#cb55-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-243"><a href="#cb55-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Checking Complaints Data}</span></span>
<span id="cb55-244"><a href="#cb55-244" aria-hidden="true" tabindex="-1"></a>display(complaints.head())</span>
<span id="cb55-245"><a href="#cb55-245" aria-hidden="true" tabindex="-1"></a>display(complaints.info())</span>
<span id="cb55-246"><a href="#cb55-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-247"><a href="#cb55-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-248"><a href="#cb55-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{python NaNs in Complaints}</span></span>
<span id="cb55-249"><a href="#cb55-249" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="ss">f'Complaints data set has </span><span class="sc">{</span>complaints[<span class="st">"Complaint Type"</span>]<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> in Complaint Type column. We can drop both safely.'</span>))</span>
<span id="cb55-250"><a href="#cb55-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-251"><a href="#cb55-251" aria-hidden="true" tabindex="-1"></a>complaints.dropna(inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb55-252"><a href="#cb55-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-253"><a href="#cb55-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-254"><a href="#cb55-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Unique DoctorIDs in Complaints}</span></span>
<span id="cb55-255"><a href="#cb55-255" aria-hidden="true" tabindex="-1"></a>num_uniq_complaints <span class="op">=</span> <span class="bu">len</span>(complaints[<span class="st">'DoctorID'</span>].unique())</span>
<span id="cb55-256"><a href="#cb55-256" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="ss">f'Number of unique DoctorIDs in complaints data is </span><span class="sc">{</span>num_uniq_complaints<span class="sc">}</span><span class="ss"> and the number of cases in this data set is </span><span class="sc">{</span>complaints<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">. Therefore, some doctors have had more than one complaints.'</span>))</span>
<span id="cb55-257"><a href="#cb55-257" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-258"><a href="#cb55-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-259"><a href="#cb55-259" aria-hidden="true" tabindex="-1"></a>To have a complaints data set with unique DoctorIDs we change the shape to the following:</span>
<span id="cb55-260"><a href="#cb55-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-261"><a href="#cb55-261" aria-hidden="true" tabindex="-1"></a><span class="in">```{python New Shape of Complaints}</span></span>
<span id="cb55-262"><a href="#cb55-262" aria-hidden="true" tabindex="-1"></a>complaints_wider <span class="op">=</span> complaints.pivot(columns <span class="op">=</span> [<span class="st">'Complaint Type'</span>], index <span class="op">=</span> [<span class="st">'DoctorID'</span>],</span>
<span id="cb55-263"><a href="#cb55-263" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [<span class="st">'Qty'</span>])</span>
<span id="cb55-264"><a href="#cb55-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-265"><a href="#cb55-265" aria-hidden="true" tabindex="-1"></a>complaints_wider.reset_index(inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb55-266"><a href="#cb55-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-267"><a href="#cb55-267" aria-hidden="true" tabindex="-1"></a>complaints_wider.fillna(<span class="dv">0</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb55-268"><a href="#cb55-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-269"><a href="#cb55-269" aria-hidden="true" tabindex="-1"></a>complaints_wider.columns <span class="op">=</span> [<span class="st">'DoctorID'</span>] <span class="op">+</span> [name[<span class="dv">1</span>] <span class="cf">for</span> name <span class="kw">in</span> complaints_wider.columns[<span class="dv">1</span>:]]</span>
<span id="cb55-270"><a href="#cb55-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-271"><a href="#cb55-271" aria-hidden="true" tabindex="-1"></a>float_columns <span class="op">=</span> complaints_wider.select_dtypes(include<span class="op">=</span>[<span class="st">'float'</span>]).columns</span>
<span id="cb55-272"><a href="#cb55-272" aria-hidden="true" tabindex="-1"></a>complaints_wider[float_columns] <span class="op">=</span> complaints_wider[float_columns].astype(<span class="bu">int</span>)</span>
<span id="cb55-273"><a href="#cb55-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-274"><a href="#cb55-274" aria-hidden="true" tabindex="-1"></a>display(complaints_wider)</span>
<span id="cb55-275"><a href="#cb55-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-276"><a href="#cb55-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-277"><a href="#cb55-277" aria-hidden="true" tabindex="-1"></a>Let's see how many complaints exist in each type:</span>
<span id="cb55-278"><a href="#cb55-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-279"><a href="#cb55-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Complaint Types Summary}</span></span>
<span id="cb55-280"><a href="#cb55-280" aria-hidden="true" tabindex="-1"></a>complaints_wider.drop(<span class="st">'DoctorID'</span>, axis <span class="op">=</span> <span class="dv">1</span>).<span class="bu">sum</span>()</span>
<span id="cb55-281"><a href="#cb55-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-282"><a href="#cb55-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-283"><a href="#cb55-283" aria-hidden="true" tabindex="-1"></a>Finally, a new feature is create to indicate the total number of complaints each doctor has made.</span>
<span id="cb55-284"><a href="#cb55-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-285"><a href="#cb55-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Total Complaints Feature}</span></span>
<span id="cb55-286"><a href="#cb55-286" aria-hidden="true" tabindex="-1"></a>complaints_wider[<span class="st">'total_complaints'</span>] <span class="op">=</span> complaints_wider.iloc[:,<span class="dv">1</span>:<span class="dv">6</span>].<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb55-287"><a href="#cb55-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-288"><a href="#cb55-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-289"><a href="#cb55-289" aria-hidden="true" tabindex="-1"></a><span class="fu"># Instructions Data</span></span>
<span id="cb55-290"><a href="#cb55-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-291"><a href="#cb55-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Checking Instructions Data}</span></span>
<span id="cb55-292"><a href="#cb55-292" aria-hidden="true" tabindex="-1"></a>display(instruction.head())</span>
<span id="cb55-293"><a href="#cb55-293" aria-hidden="true" tabindex="-1"></a>display(instruction.info())</span>
<span id="cb55-294"><a href="#cb55-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-295"><a href="#cb55-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-296"><a href="#cb55-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Unique DoctorIDs in Instruction}</span></span>
<span id="cb55-297"><a href="#cb55-297" aria-hidden="true" tabindex="-1"></a>num_uniq_instruction <span class="op">=</span> <span class="bu">len</span>(instruction[<span class="st">'DoctorID'</span>].unique())</span>
<span id="cb55-298"><a href="#cb55-298" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="ss">f'Number of unique DoctorIDs in instruction data is </span><span class="sc">{</span>num_uniq_instruction<span class="sc">}</span><span class="ss"> and the number of cases in this data set is </span><span class="sc">{</span>instruction<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">. In other words, there are no duplicated instructions.'</span>))</span>
<span id="cb55-299"><a href="#cb55-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-300"><a href="#cb55-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-301"><a href="#cb55-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Changing Instructions Column to Integer}</span></span>
<span id="cb55-302"><a href="#cb55-302" aria-hidden="true" tabindex="-1"></a>instruction.replace({<span class="st">'Yes'</span>:<span class="dv">1</span>, <span class="st">'No'</span>:<span class="dv">0</span>}, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb55-303"><a href="#cb55-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-304"><a href="#cb55-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-305"><a href="#cb55-305" aria-hidden="true" tabindex="-1"></a><span class="fu"># Merged Data</span></span>
<span id="cb55-306"><a href="#cb55-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-307"><a href="#cb55-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Merged Data Set}</span></span>
<span id="cb55-308"><a href="#cb55-308" aria-hidden="true" tabindex="-1"></a>merged_data <span class="op">=</span> doctors.merge(agg_orders, on <span class="op">=</span> <span class="st">'DoctorID'</span>, how <span class="op">=</span> <span class="st">'left'</span>)<span class="op">\</span></span>
<span id="cb55-309"><a href="#cb55-309" aria-hidden="true" tabindex="-1"></a>.merge(complaints_wider, on <span class="op">=</span> <span class="st">'DoctorID'</span>, how <span class="op">=</span> <span class="st">'left'</span>)<span class="op">\</span></span>
<span id="cb55-310"><a href="#cb55-310" aria-hidden="true" tabindex="-1"></a>.merge(instruction, on <span class="op">=</span> <span class="st">'DoctorID'</span>, how <span class="op">=</span> <span class="st">'left'</span>)</span>
<span id="cb55-311"><a href="#cb55-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-312"><a href="#cb55-312" aria-hidden="true" tabindex="-1"></a>missing_merged <span class="op">=</span> merged_data.loc[:,<span class="st">'Condition A'</span>:].columns</span>
<span id="cb55-313"><a href="#cb55-313" aria-hidden="true" tabindex="-1"></a>merged_data[missing_merged] <span class="op">=</span> merged_data[missing_merged].fillna(<span class="dv">0</span>)</span>
<span id="cb55-314"><a href="#cb55-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-315"><a href="#cb55-315" aria-hidden="true" tabindex="-1"></a>int_columns <span class="op">=</span> merged_data.loc[:,<span class="st">'Condition A'</span>:<span class="st">'Instructions'</span>].columns</span>
<span id="cb55-316"><a href="#cb55-316" aria-hidden="true" tabindex="-1"></a>merged_data[int_columns] <span class="op">=</span> merged_data[int_columns].astype(<span class="st">'float16'</span>)</span>
<span id="cb55-317"><a href="#cb55-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-318"><a href="#cb55-318" aria-hidden="true" tabindex="-1"></a>display(merged_data)</span>
<span id="cb55-319"><a href="#cb55-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-320"><a href="#cb55-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-321"><a href="#cb55-321" aria-hidden="true" tabindex="-1"></a><span class="fu"># Missing Values</span></span>
<span id="cb55-322"><a href="#cb55-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-323"><a href="#cb55-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Merged Data set Missings}</span></span>
<span id="cb55-324"><a href="#cb55-324" aria-hidden="true" tabindex="-1"></a>msno.bar(merged_data, figsize <span class="op">=</span> (<span class="dv">9</span>,<span class="dv">9</span>))</span>
<span id="cb55-325"><a href="#cb55-325" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-326"><a href="#cb55-326" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-327"><a href="#cb55-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-328"><a href="#cb55-328" aria-hidden="true" tabindex="-1"></a>msno.matrix(merged_data, figsize <span class="op">=</span> (<span class="dv">9</span>,<span class="dv">9</span>))</span>
<span id="cb55-329"><a href="#cb55-329" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-330"><a href="#cb55-330" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-331"><a href="#cb55-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-332"><a href="#cb55-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-333"><a href="#cb55-333" aria-hidden="true" tabindex="-1"></a>There are two cases in which Rank column has no information and it is acceptable to consider such missings MCAR (Missing Completely at Random). The best thing we can do here is to omit both of them.</span>
<span id="cb55-334"><a href="#cb55-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-335"><a href="#cb55-335" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Dropping Missing Ranks}</span></span>
<span id="cb55-336"><a href="#cb55-336" aria-hidden="true" tabindex="-1"></a>merged_data.dropna(subset <span class="op">=</span> [<span class="st">'Rank'</span>], inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb55-337"><a href="#cb55-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-338"><a href="#cb55-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-339"><a href="#cb55-339" aria-hidden="true" tabindex="-1"></a>Lets see if we can find out any relationship between other variables and missing values in <span class="in">`Satisfaction`</span> field.</span>
<span id="cb55-340"><a href="#cb55-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-341"><a href="#cb55-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Relationship between Missing Values and Other Features}</span></span>
<span id="cb55-342"><a href="#cb55-342" aria-hidden="true" tabindex="-1"></a>merged_data[<span class="st">'Satisfaction_na'</span>] <span class="op">=</span> merged_data[<span class="st">'Satisfaction'</span>].isnull()</span>
<span id="cb55-343"><a href="#cb55-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-344"><a href="#cb55-344" aria-hidden="true" tabindex="-1"></a>merged_data.groupby(<span class="st">'Category'</span>)[<span class="st">'Satisfaction_na'</span>]<span class="op">\</span></span>
<span id="cb55-345"><a href="#cb55-345" aria-hidden="true" tabindex="-1"></a>.value_counts()</span>
<span id="cb55-346"><a href="#cb55-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-347"><a href="#cb55-347" aria-hidden="true" tabindex="-1"></a>merged_data.groupby(<span class="st">'Rank'</span>)[<span class="st">'Satisfaction_na'</span>]<span class="op">\</span></span>
<span id="cb55-348"><a href="#cb55-348" aria-hidden="true" tabindex="-1"></a>.value_counts()</span>
<span id="cb55-349"><a href="#cb55-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-350"><a href="#cb55-350" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x <span class="op">=</span> <span class="st">'Incidence rate'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_na'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-351"><a href="#cb55-351" aria-hidden="true" tabindex="-1"></a>sns.rugplot(x <span class="op">=</span> <span class="st">'Incidence rate'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_na'</span>, data <span class="op">=</span> merged_data, height <span class="op">=</span> <span class="fl">0.04</span>)</span>
<span id="cb55-352"><a href="#cb55-352" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-353"><a href="#cb55-353" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-354"><a href="#cb55-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-355"><a href="#cb55-355" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x <span class="op">=</span> <span class="st">'R rate'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_na'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-356"><a href="#cb55-356" aria-hidden="true" tabindex="-1"></a>sns.rugplot(x <span class="op">=</span> <span class="st">'R rate'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_na'</span>, data <span class="op">=</span> merged_data, height <span class="op">=</span> <span class="fl">0.04</span>)</span>
<span id="cb55-357"><a href="#cb55-357" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-358"><a href="#cb55-358" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-359"><a href="#cb55-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-360"><a href="#cb55-360" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x <span class="op">=</span> <span class="st">'Experience'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_na'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-361"><a href="#cb55-361" aria-hidden="true" tabindex="-1"></a>sns.rugplot(x <span class="op">=</span> <span class="st">'Experience'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_na'</span>, data <span class="op">=</span> merged_data, height <span class="op">=</span> <span class="fl">0.04</span>)</span>
<span id="cb55-362"><a href="#cb55-362" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-363"><a href="#cb55-363" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-364"><a href="#cb55-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-365"><a href="#cb55-365" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x <span class="op">=</span> <span class="st">'last_purchases'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_na'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-366"><a href="#cb55-366" aria-hidden="true" tabindex="-1"></a>sns.rugplot(x <span class="op">=</span> <span class="st">'last_purchases'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_na'</span>, data <span class="op">=</span> merged_data, height <span class="op">=</span> <span class="fl">0.04</span>)</span>
<span id="cb55-367"><a href="#cb55-367" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-368"><a href="#cb55-368" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-369"><a href="#cb55-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-370"><a href="#cb55-370" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x <span class="op">=</span> <span class="st">'total_complaints'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_na'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-371"><a href="#cb55-371" aria-hidden="true" tabindex="-1"></a>sns.rugplot(x <span class="op">=</span> <span class="st">'total_complaints'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_na'</span>, data <span class="op">=</span> merged_data, height <span class="op">=</span> <span class="fl">0.04</span>)</span>
<span id="cb55-372"><a href="#cb55-372" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-373"><a href="#cb55-373" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-374"><a href="#cb55-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-375"><a href="#cb55-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-376"><a href="#cb55-376" aria-hidden="true" tabindex="-1"></a>These plots suggest no pattern either. However, we intend to impute missing values with multiple imputation technique using miclust package in R.</span>
<span id="cb55-377"><a href="#cb55-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-378"><a href="#cb55-378" aria-hidden="true" tabindex="-1"></a><span class="fu"># Question 1</span></span>
<span id="cb55-379"><a href="#cb55-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-380"><a href="#cb55-380" aria-hidden="true" tabindex="-1"></a>First, we group data by Region column then aggregate doctors data set to get the answer. In the next plot, the number of doctors and the average purchases in each region are demonstrated.</span>
<span id="cb55-381"><a href="#cb55-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-382"><a href="#cb55-382" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Number of Doctors in each Region}</span></span>
<span id="cb55-383"><a href="#cb55-383" aria-hidden="true" tabindex="-1"></a>agg_doctors <span class="op">=</span> doctors.groupby(<span class="st">'Region'</span>).size().to_frame().reset_index()</span>
<span id="cb55-384"><a href="#cb55-384" aria-hidden="true" tabindex="-1"></a>agg_doctors.columns <span class="op">=</span> [<span class="st">"Region"</span>,<span class="st">"Count"</span>]</span>
<span id="cb55-385"><a href="#cb55-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-386"><a href="#cb55-386" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">9</span>,<span class="dv">9</span>))</span>
<span id="cb55-387"><a href="#cb55-387" aria-hidden="true" tabindex="-1"></a>sns.barplot(x <span class="op">=</span> <span class="st">'Count'</span>, y <span class="op">=</span> <span class="st">'Region'</span>, data <span class="op">=</span> agg_doctors, </span>
<span id="cb55-388"><a href="#cb55-388" aria-hidden="true" tabindex="-1"></a>order<span class="op">=</span>agg_doctors.sort_values([<span class="st">'Count'</span>], ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'Region'</span>], </span>
<span id="cb55-389"><a href="#cb55-389" aria-hidden="true" tabindex="-1"></a>palette<span class="op">=</span>sns.color_palette(<span class="st">"Reds"</span>, <span class="dv">46</span>)[::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb55-390"><a href="#cb55-390" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-391"><a href="#cb55-391" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-392"><a href="#cb55-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-393"><a href="#cb55-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-394"><a href="#cb55-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Average Purchases in each Region}</span></span>
<span id="cb55-395"><a href="#cb55-395" aria-hidden="true" tabindex="-1"></a>agg_doctors <span class="op">=</span> doctors.groupby(<span class="st">'Region'</span>)[<span class="st">'last_purchases'</span>].agg(<span class="st">'mean'</span>).reset_index()</span>
<span id="cb55-396"><a href="#cb55-396" aria-hidden="true" tabindex="-1"></a>agg_doctors.columns <span class="op">=</span> [<span class="st">'Region'</span>,<span class="st">'avg_purchases'</span>]</span>
<span id="cb55-397"><a href="#cb55-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-398"><a href="#cb55-398" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">9</span>,<span class="dv">9</span>))</span>
<span id="cb55-399"><a href="#cb55-399" aria-hidden="true" tabindex="-1"></a>sns.barplot(x <span class="op">=</span> <span class="st">'avg_purchases'</span>, y <span class="op">=</span> <span class="st">'Region'</span>, data <span class="op">=</span> agg_doctors, order<span class="op">=</span>agg_doctors.sort_values(<span class="st">'avg_purchases'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'Region'</span>], </span>
<span id="cb55-400"><a href="#cb55-400" aria-hidden="true" tabindex="-1"></a>palette<span class="op">=</span>sns.color_palette(<span class="st">"Blues"</span>, <span class="dv">46</span>)[::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb55-401"><a href="#cb55-401" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Average Last Year Purchases'</span>)</span>
<span id="cb55-402"><a href="#cb55-402" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-403"><a href="#cb55-403" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-404"><a href="#cb55-404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-405"><a href="#cb55-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-406"><a href="#cb55-406" aria-hidden="true" tabindex="-1"></a><span class="fu"># Question 2</span></span>
<span id="cb55-407"><a href="#cb55-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-408"><a href="#cb55-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Total Complaints vs. Purchases}</span></span>
<span id="cb55-409"><a href="#cb55-409" aria-hidden="true" tabindex="-1"></a>complaints_purchases <span class="op">=</span> merged_data.loc[:,[<span class="st">'DoctorID'</span>, <span class="st">'last_purchases'</span>, <span class="st">'Correct'</span>, <span class="st">'Incorrect'</span>, <span class="st">'R&amp;R'</span>, <span class="st">'Specific'</span>, <span class="st">'total_complaints'</span>]]</span>
<span id="cb55-410"><a href="#cb55-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-411"><a href="#cb55-411" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb55-412"><a href="#cb55-412" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x <span class="op">=</span> <span class="st">'total_complaints'</span>, y <span class="op">=</span> <span class="st">'last_purchases'</span>, data <span class="op">=</span> complaints_purchases)</span>
<span id="cb55-413"><a href="#cb55-413" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Total Complaints'</span>)</span>
<span id="cb55-414"><a href="#cb55-414" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Purchases of Last Year'</span>)</span>
<span id="cb55-415"><a href="#cb55-415" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="dv">0</span>,<span class="dv">21</span>))</span>
<span id="cb55-416"><a href="#cb55-416" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-417"><a href="#cb55-417" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-418"><a href="#cb55-418" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-419"><a href="#cb55-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-420"><a href="#cb55-420" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Correct and Incorrect vs. Purchases}</span></span>
<span id="cb55-421"><a href="#cb55-421" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x <span class="op">=</span> <span class="st">'Correct'</span>, y <span class="op">=</span> <span class="st">'last_purchases'</span>, data <span class="op">=</span> complaints_purchases)</span>
<span id="cb55-422"><a href="#cb55-422" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Correct Complaints'</span>)</span>
<span id="cb55-423"><a href="#cb55-423" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Purchases of Last Year'</span>)</span>
<span id="cb55-424"><a href="#cb55-424" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="dv">0</span>,<span class="dv">21</span>))</span>
<span id="cb55-425"><a href="#cb55-425" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-426"><a href="#cb55-426" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-427"><a href="#cb55-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-428"><a href="#cb55-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-429"><a href="#cb55-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Incorrect and Incorrect vs. Purchases}</span></span>
<span id="cb55-430"><a href="#cb55-430" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x <span class="op">=</span> <span class="st">'Incorrect'</span>, y <span class="op">=</span> <span class="st">'last_purchases'</span>, data <span class="op">=</span> complaints_purchases)</span>
<span id="cb55-431"><a href="#cb55-431" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Incorrect Complaints'</span>)</span>
<span id="cb55-432"><a href="#cb55-432" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Purchases of Last Year'</span>)</span>
<span id="cb55-433"><a href="#cb55-433" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="dv">0</span>,<span class="dv">21</span>))</span>
<span id="cb55-434"><a href="#cb55-434" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-435"><a href="#cb55-435" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-436"><a href="#cb55-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-437"><a href="#cb55-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-438"><a href="#cb55-438" aria-hidden="true" tabindex="-1"></a>Figures shown in above suggest number of purchases of a doctor decreases when they send their complaints to the company. This relationship is slightly more obvious if doctors complaints have been accepted by the company compared with the cases in which their complaints were not correct.</span>
<span id="cb55-439"><a href="#cb55-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-440"><a href="#cb55-440" aria-hidden="true" tabindex="-1"></a><span class="fu"># Question 3</span></span>
<span id="cb55-441"><a href="#cb55-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-442"><a href="#cb55-442" aria-hidden="true" tabindex="-1"></a><span class="fu">## Scaling and Creation of Dummies</span></span>
<span id="cb55-443"><a href="#cb55-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-444"><a href="#cb55-444" aria-hidden="true" tabindex="-1"></a>Clustering methods require to have an scaled and numeric data as inputs. To satisfy such constraints, we use functions from sklearn and pandas package in this section.</span>
<span id="cb55-445"><a href="#cb55-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-446"><a href="#cb55-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Preprocessing Data}</span></span>
<span id="cb55-447"><a href="#cb55-447" aria-hidden="true" tabindex="-1"></a><span class="co"># columns_to_drop = merged_data.columns.str.contains('Condition')</span></span>
<span id="cb55-448"><a href="#cb55-448" aria-hidden="true" tabindex="-1"></a><span class="co"># columns_to_drop = merged_data.columns[columns_to_drop]</span></span>
<span id="cb55-449"><a href="#cb55-449" aria-hidden="true" tabindex="-1"></a>preprocessed_data <span class="op">=</span> merged_data.drop(columns <span class="op">=</span> [<span class="st">'DoctorID'</span>, <span class="st">'Region'</span>, <span class="st">'Satisfaction_na'</span>])</span>
<span id="cb55-450"><a href="#cb55-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-451"><a href="#cb55-451" aria-hidden="true" tabindex="-1"></a>preprocessed_data <span class="op">=</span> pd.get_dummies(data <span class="op">=</span> preprocessed_data, columns <span class="op">=</span> [<span class="st">'Category'</span>, <span class="st">'Rank'</span>], drop_first <span class="op">=</span> <span class="va">True</span>).replace({<span class="va">True</span>:<span class="dv">1</span>, <span class="va">False</span>:<span class="dv">0</span>})</span>
<span id="cb55-452"><a href="#cb55-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-453"><a href="#cb55-453" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb55-454"><a href="#cb55-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-455"><a href="#cb55-455" aria-hidden="true" tabindex="-1"></a>excluding_sat <span class="op">=</span> preprocessed_data.columns<span class="op">!=</span><span class="st">'Satisfaction'</span></span>
<span id="cb55-456"><a href="#cb55-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-457"><a href="#cb55-457" aria-hidden="true" tabindex="-1"></a>preprocessed_data.loc[:,excluding_sat] <span class="op">=</span> scaler.fit_transform(preprocessed_data.loc[:,excluding_sat])</span>
<span id="cb55-458"><a href="#cb55-458" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-459"><a href="#cb55-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-460"><a href="#cb55-460" aria-hidden="true" tabindex="-1"></a><span class="fu"># Satisfaction Imputation</span></span>
<span id="cb55-461"><a href="#cb55-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-462"><a href="#cb55-462" aria-hidden="true" tabindex="-1"></a><span class="fu">## Imputation with KNN</span></span>
<span id="cb55-463"><a href="#cb55-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-464"><a href="#cb55-464" aria-hidden="true" tabindex="-1"></a>First few rows of imputed satisfaction column with KNN method:</span>
<span id="cb55-465"><a href="#cb55-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-466"><a href="#cb55-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{python KNN Imputation}</span></span>
<span id="cb55-467"><a href="#cb55-467" aria-hidden="true" tabindex="-1"></a>knn_imputer <span class="op">=</span> KNNImputer(n_neighbors <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb55-468"><a href="#cb55-468" aria-hidden="true" tabindex="-1"></a>knn_imputed <span class="op">=</span> knn_imputer.fit_transform(preprocessed_data)</span>
<span id="cb55-469"><a href="#cb55-469" aria-hidden="true" tabindex="-1"></a>merged_knn_imputed <span class="op">=</span> preprocessed_data.copy(deep <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb55-470"><a href="#cb55-470" aria-hidden="true" tabindex="-1"></a>merged_knn_imputed.iloc[:,:] <span class="op">=</span> knn_imputed</span>
<span id="cb55-471"><a href="#cb55-471" aria-hidden="true" tabindex="-1"></a>display(merged_knn_imputed.loc[:, <span class="st">'Satisfaction'</span>].head())</span>
<span id="cb55-472"><a href="#cb55-472" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-473"><a href="#cb55-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-474"><a href="#cb55-474" aria-hidden="true" tabindex="-1"></a><span class="fu">## Imputation with Iterative Imputation</span></span>
<span id="cb55-475"><a href="#cb55-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-476"><a href="#cb55-476" aria-hidden="true" tabindex="-1"></a>First few rows of imputed satisfaction column with Iterative method:</span>
<span id="cb55-477"><a href="#cb55-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-478"><a href="#cb55-478" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Iterative Imputation}</span></span>
<span id="cb55-479"><a href="#cb55-479" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb55-480"><a href="#cb55-480" aria-hidden="true" tabindex="-1"></a>iter_imputer <span class="op">=</span> IterativeImputer(sample_posterior <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb55-481"><a href="#cb55-481" aria-hidden="true" tabindex="-1"></a>iter_imputer.fit(preprocessed_data)</span>
<span id="cb55-482"><a href="#cb55-482" aria-hidden="true" tabindex="-1"></a>iter_imputer.n_iter_</span>
<span id="cb55-483"><a href="#cb55-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-484"><a href="#cb55-484" aria-hidden="true" tabindex="-1"></a>iter_imputed <span class="op">=</span> iter_imputer.transform(preprocessed_data)</span>
<span id="cb55-485"><a href="#cb55-485" aria-hidden="true" tabindex="-1"></a>merged_iter_imputed <span class="op">=</span> preprocessed_data.copy(deep <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb55-486"><a href="#cb55-486" aria-hidden="true" tabindex="-1"></a>merged_iter_imputed.iloc[:,:] <span class="op">=</span> iter_imputed</span>
<span id="cb55-487"><a href="#cb55-487" aria-hidden="true" tabindex="-1"></a>display(merged_iter_imputed.loc[:, <span class="st">'Satisfaction'</span>].head())</span>
<span id="cb55-488"><a href="#cb55-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-489"><a href="#cb55-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-490"><a href="#cb55-490" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparing Two Imputations</span></span>
<span id="cb55-491"><a href="#cb55-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-492"><a href="#cb55-492" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Satisfaction_NA Creation}</span></span>
<span id="cb55-493"><a href="#cb55-493" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb55-494"><a href="#cb55-494" aria-hidden="true" tabindex="-1"></a>merged_knn_imputed[<span class="st">'Satisfaction_NA'</span>] <span class="op">=</span> preprocessed_data[<span class="st">'Satisfaction'</span>].isnull()</span>
<span id="cb55-495"><a href="#cb55-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-496"><a href="#cb55-496" aria-hidden="true" tabindex="-1"></a>merged_iter_imputed[<span class="st">'Satisfaction_NA'</span>] <span class="op">=</span> preprocessed_data[<span class="st">'Satisfaction'</span>].isnull()</span>
<span id="cb55-497"><a href="#cb55-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-498"><a href="#cb55-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-499"><a href="#cb55-499" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Comparing Imputations}</span></span>
<span id="cb55-500"><a href="#cb55-500" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb55-501"><a href="#cb55-501" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x <span class="op">=</span> <span class="st">'Satisfaction'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_NA'</span>, data <span class="op">=</span> merged_knn_imputed)</span>
<span id="cb55-502"><a href="#cb55-502" aria-hidden="true" tabindex="-1"></a>sns.rugplot(x <span class="op">=</span> <span class="st">'Satisfaction'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_NA'</span>, data <span class="op">=</span> merged_knn_imputed)</span>
<span id="cb55-503"><a href="#cb55-503" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Satisfaction Imputation with KNN Method'</span>)</span>
<span id="cb55-504"><a href="#cb55-504" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-505"><a href="#cb55-505" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-506"><a href="#cb55-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-507"><a href="#cb55-507" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x <span class="op">=</span> <span class="st">'Satisfaction'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_NA'</span>, data <span class="op">=</span> merged_iter_imputed)</span>
<span id="cb55-508"><a href="#cb55-508" aria-hidden="true" tabindex="-1"></a>sns.rugplot(x <span class="op">=</span> <span class="st">'Satisfaction'</span>, hue <span class="op">=</span> <span class="st">'Satisfaction_NA'</span>, data <span class="op">=</span> merged_iter_imputed)</span>
<span id="cb55-509"><a href="#cb55-509" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Satisfaction Imputation with Iterative Method'</span>)</span>
<span id="cb55-510"><a href="#cb55-510" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-511"><a href="#cb55-511" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-512"><a href="#cb55-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-513"><a href="#cb55-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-514"><a href="#cb55-514" aria-hidden="true" tabindex="-1"></a>Itarative Imputation predicted extreme values of satisfaction, which is not acceptable for our analysis. Also, the difference between peaks of imputed and observed values in KNN model is less than that of Iterative algorithm. We continue with imputed satisfaction generated by the KNN model.</span>
<span id="cb55-515"><a href="#cb55-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-516"><a href="#cb55-516" aria-hidden="true" tabindex="-1"></a><span class="fu"># Hierarchical Clustering</span></span>
<span id="cb55-517"><a href="#cb55-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-518"><a href="#cb55-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Clustering Preprocessing}</span></span>
<span id="cb55-519"><a href="#cb55-519" aria-hidden="true" tabindex="-1"></a><span class="co"># merged_knn_imputed.drop('Satisfaction_NA', axis = 1, inplace = True)</span></span>
<span id="cb55-520"><a href="#cb55-520" aria-hidden="true" tabindex="-1"></a>merged_knn_imputed.iloc[:,:] <span class="op">=</span> scaler.fit_transform(merged_knn_imputed)</span>
<span id="cb55-521"><a href="#cb55-521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-522"><a href="#cb55-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-523"><a href="#cb55-523" aria-hidden="true" tabindex="-1"></a>Dendrogram plot demonstrates how far two clusters are before their integration into one. In other words, if two clusters are too far from each other, their vertical line showing distance is bigger. It's recommended that the analyst cut the tree in a distance in which so many dissimilarities are not ignored.</span>
<span id="cb55-524"><a href="#cb55-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-525"><a href="#cb55-525" aria-hidden="true" tabindex="-1"></a>**Here, the dendrogram proposes 3 clusters.**</span>
<span id="cb55-526"><a href="#cb55-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-527"><a href="#cb55-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Hierarchical}</span></span>
<span id="cb55-528"><a href="#cb55-528" aria-hidden="true" tabindex="-1"></a>link <span class="op">=</span> linkage(merged_knn_imputed, method <span class="op">=</span> <span class="st">'ward'</span>, metric <span class="op">=</span> <span class="st">'euclidean'</span>)</span>
<span id="cb55-529"><a href="#cb55-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-530"><a href="#cb55-530" aria-hidden="true" tabindex="-1"></a>dendrogram(link)</span>
<span id="cb55-531"><a href="#cb55-531" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-532"><a href="#cb55-532" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-533"><a href="#cb55-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-534"><a href="#cb55-534" aria-hidden="true" tabindex="-1"></a>merged_data[<span class="st">'hierarchy_clust'</span>] <span class="op">=</span> fcluster(link, <span class="dv">3</span>, criterion <span class="op">=</span> <span class="st">'maxclust'</span>)</span>
<span id="cb55-535"><a href="#cb55-535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-536"><a href="#cb55-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-537"><a href="#cb55-537" aria-hidden="true" tabindex="-1"></a>The plots shown here are attempting to distinguish segments the hierarchical clustering has generated. In case the vital metrics differ in a meaningful manner, we succeed in our segmentation. Otherwise, we must continue working on the algorithm and data to get a better result.</span>
<span id="cb55-538"><a href="#cb55-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-539"><a href="#cb55-539" aria-hidden="true" tabindex="-1"></a>Dot plots represent averages in each group alongside a vertical bar that can be interpreted as uncertainty. The more variance or standard deviation of the mean, the longer the vertical bar.</span>
<span id="cb55-540"><a href="#cb55-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-541"><a href="#cb55-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Hierarchical Clustering Plots}</span></span>
<span id="cb55-542"><a href="#cb55-542" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb55-543"><a href="#cb55-543" aria-hidden="true" tabindex="-1"></a>sns.countplot(x <span class="op">=</span> <span class="st">'hierarchy_clust'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-544"><a href="#cb55-544" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group'</span>)</span>
<span id="cb55-545"><a href="#cb55-545" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb55-546"><a href="#cb55-546" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-547"><a href="#cb55-547" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-548"><a href="#cb55-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-549"><a href="#cb55-549" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'hierarchy_clust'</span>, y <span class="op">=</span> <span class="st">'Incidence rate'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-550"><a href="#cb55-550" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group'</span>)</span>
<span id="cb55-551"><a href="#cb55-551" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Incidence Rate'</span>)</span>
<span id="cb55-552"><a href="#cb55-552" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-553"><a href="#cb55-553" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-554"><a href="#cb55-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-555"><a href="#cb55-555" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'hierarchy_clust'</span>, y <span class="op">=</span> <span class="st">'R rate'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-556"><a href="#cb55-556" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group'</span>)</span>
<span id="cb55-557"><a href="#cb55-557" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average R Rate'</span>)</span>
<span id="cb55-558"><a href="#cb55-558" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-559"><a href="#cb55-559" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-560"><a href="#cb55-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-561"><a href="#cb55-561" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'hierarchy_clust'</span>, y <span class="op">=</span> <span class="st">'Satisfaction'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-562"><a href="#cb55-562" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group'</span>)</span>
<span id="cb55-563"><a href="#cb55-563" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Satisfaction'</span>)</span>
<span id="cb55-564"><a href="#cb55-564" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-565"><a href="#cb55-565" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-566"><a href="#cb55-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-567"><a href="#cb55-567" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'hierarchy_clust'</span>, y <span class="op">=</span> <span class="st">'Experience'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-568"><a href="#cb55-568" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group'</span>)</span>
<span id="cb55-569"><a href="#cb55-569" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Experience'</span>)</span>
<span id="cb55-570"><a href="#cb55-570" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-571"><a href="#cb55-571" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-572"><a href="#cb55-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-573"><a href="#cb55-573" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'hierarchy_clust'</span>, y <span class="op">=</span> <span class="st">'last_purchases'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-574"><a href="#cb55-574" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group'</span>)</span>
<span id="cb55-575"><a href="#cb55-575" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Last Year Purchases'</span>)</span>
<span id="cb55-576"><a href="#cb55-576" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-577"><a href="#cb55-577" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-578"><a href="#cb55-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-579"><a href="#cb55-579" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'hierarchy_clust'</span>, y <span class="op">=</span> <span class="st">'total_orders'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-580"><a href="#cb55-580" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group'</span>)</span>
<span id="cb55-581"><a href="#cb55-581" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'This Year Orders'</span>)</span>
<span id="cb55-582"><a href="#cb55-582" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-583"><a href="#cb55-583" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-584"><a href="#cb55-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-585"><a href="#cb55-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-586"><a href="#cb55-586" aria-hidden="true" tabindex="-1"></a>Results are not satisfactory, so it's a good idea to reduce the number of features or dimensions since cluster analysis works better with more informed components.</span>
<span id="cb55-587"><a href="#cb55-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-588"><a href="#cb55-588" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hierarchical with PCA</span></span>
<span id="cb55-589"><a href="#cb55-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-590"><a href="#cb55-590" aria-hidden="true" tabindex="-1"></a>Principal Component Analysis is a popular algorithm that aims to reduce the number of features or dimensions in a dataframe. One of the most beneficial outcome of this method is that we can identify lower number of features explaining the most part of variance in a data set. This would help to get the most compact useful information leading to a practical segmentation. The following results have been obtained after PCA is applied to the merged data set of individual doctors.</span>
<span id="cb55-591"><a href="#cb55-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-592"><a href="#cb55-592" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Kernel PCA}</span></span>
<span id="cb55-593"><a href="#cb55-593" aria-hidden="true" tabindex="-1"></a>pca_mdl <span class="op">=</span> KernelPCA(n_components <span class="op">=</span> <span class="dv">5</span>,random_state <span class="op">=</span> <span class="dv">10</span>, kernel <span class="op">=</span> <span class="st">'rbf'</span>)</span>
<span id="cb55-594"><a href="#cb55-594" aria-hidden="true" tabindex="-1"></a>pca_mdl.fit(merged_knn_imputed)</span>
<span id="cb55-595"><a href="#cb55-595" aria-hidden="true" tabindex="-1"></a>transformed_pca <span class="op">=</span> pca_mdl.transform(merged_knn_imputed)</span>
<span id="cb55-596"><a href="#cb55-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-597"><a href="#cb55-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-598"><a href="#cb55-598" aria-hidden="true" tabindex="-1"></a>**Here, the dendrogram proposes 6 clusters.**</span>
<span id="cb55-599"><a href="#cb55-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-600"><a href="#cb55-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Hierarchical with PCA}</span></span>
<span id="cb55-601"><a href="#cb55-601" aria-hidden="true" tabindex="-1"></a>link_pca <span class="op">=</span> linkage(transformed_pca, method <span class="op">=</span> <span class="st">'ward'</span>, metric <span class="op">=</span> <span class="st">'euclidean'</span>)</span>
<span id="cb55-602"><a href="#cb55-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-603"><a href="#cb55-603" aria-hidden="true" tabindex="-1"></a>dendrogram(link_pca)</span>
<span id="cb55-604"><a href="#cb55-604" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-605"><a href="#cb55-605" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-606"><a href="#cb55-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-607"><a href="#cb55-607" aria-hidden="true" tabindex="-1"></a>merged_data[<span class="st">'hierarchy_clust_pca'</span>] <span class="op">=</span> fcluster(link_pca, <span class="dv">6</span>, criterion <span class="op">=</span> <span class="st">'maxclust'</span>)</span>
<span id="cb55-608"><a href="#cb55-608" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-609"><a href="#cb55-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-610"><a href="#cb55-610" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Plots of Hierarchical Clustering with PCA}</span></span>
<span id="cb55-611"><a href="#cb55-611" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb55-612"><a href="#cb55-612" aria-hidden="true" tabindex="-1"></a>sns.countplot(x <span class="op">=</span> <span class="st">'hierarchy_clust_pca'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-613"><a href="#cb55-613" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group - PCA'</span>)</span>
<span id="cb55-614"><a href="#cb55-614" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb55-615"><a href="#cb55-615" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-616"><a href="#cb55-616" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-617"><a href="#cb55-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-618"><a href="#cb55-618" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'hierarchy_clust_pca'</span>, y <span class="op">=</span> <span class="st">'Incidence rate'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-619"><a href="#cb55-619" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group - PCA'</span>)</span>
<span id="cb55-620"><a href="#cb55-620" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Incidence Rate'</span>)</span>
<span id="cb55-621"><a href="#cb55-621" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-622"><a href="#cb55-622" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-623"><a href="#cb55-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-624"><a href="#cb55-624" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'hierarchy_clust_pca'</span>, y <span class="op">=</span> <span class="st">'R rate'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-625"><a href="#cb55-625" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group - PCA'</span>)</span>
<span id="cb55-626"><a href="#cb55-626" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average R Rate'</span>)</span>
<span id="cb55-627"><a href="#cb55-627" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-628"><a href="#cb55-628" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-629"><a href="#cb55-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-630"><a href="#cb55-630" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'hierarchy_clust_pca'</span>, y <span class="op">=</span> <span class="st">'Satisfaction'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-631"><a href="#cb55-631" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group - PCA'</span>)</span>
<span id="cb55-632"><a href="#cb55-632" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Satisfaction'</span>)</span>
<span id="cb55-633"><a href="#cb55-633" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-634"><a href="#cb55-634" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-635"><a href="#cb55-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-636"><a href="#cb55-636" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'hierarchy_clust_pca'</span>, y <span class="op">=</span> <span class="st">'Experience'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-637"><a href="#cb55-637" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group - PCA'</span>)</span>
<span id="cb55-638"><a href="#cb55-638" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Experience'</span>)</span>
<span id="cb55-639"><a href="#cb55-639" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-640"><a href="#cb55-640" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-641"><a href="#cb55-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-642"><a href="#cb55-642" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'hierarchy_clust_pca'</span>, y <span class="op">=</span> <span class="st">'last_purchases'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-643"><a href="#cb55-643" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group - PCA'</span>)</span>
<span id="cb55-644"><a href="#cb55-644" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Last Year Purchases'</span>)</span>
<span id="cb55-645"><a href="#cb55-645" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-646"><a href="#cb55-646" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-647"><a href="#cb55-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-648"><a href="#cb55-648" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'hierarchy_clust_pca'</span>, y <span class="op">=</span> <span class="st">'total_orders'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data)</span>
<span id="cb55-649"><a href="#cb55-649" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Group - PCA'</span>)</span>
<span id="cb55-650"><a href="#cb55-650" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'This Year Orders'</span>)</span>
<span id="cb55-651"><a href="#cb55-651" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-652"><a href="#cb55-652" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-653"><a href="#cb55-653" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-654"><a href="#cb55-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-655"><a href="#cb55-655" aria-hidden="true" tabindex="-1"></a><span class="fu"># KMeans Clustering</span></span>
<span id="cb55-656"><a href="#cb55-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-657"><a href="#cb55-657" aria-hidden="true" tabindex="-1"></a>This algorithm is another option that can be used for clustering. However, since the number of clusters must be given to the function in order to start manipulating centroids to get the best result, we create a loop in which different numbers go into the function and with the elbow plot we try to detect the finest number of clusters. In elbow plot, the distance between a centroid and the observations around it is calculated (distorsion). In case an additional centroid or cluster doesn't reduce distorsions to the previous rate, we stop searching and select the number before the last one.</span>
<span id="cb55-658"><a href="#cb55-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-659"><a href="#cb55-659" aria-hidden="true" tabindex="-1"></a><span class="in">```{python KMeans Distorsions}</span></span>
<span id="cb55-660"><a href="#cb55-660" aria-hidden="true" tabindex="-1"></a>distorsions <span class="op">=</span> []</span>
<span id="cb55-661"><a href="#cb55-661" aria-hidden="true" tabindex="-1"></a>num_clusters <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2</span>,<span class="dv">10</span>)</span>
<span id="cb55-662"><a href="#cb55-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-663"><a href="#cb55-663" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> num_clusters:</span>
<span id="cb55-664"><a href="#cb55-664" aria-hidden="true" tabindex="-1"></a>    centroids, distorsion <span class="op">=</span> kmeans(merged_knn_imputed, i)</span>
<span id="cb55-665"><a href="#cb55-665" aria-hidden="true" tabindex="-1"></a>    distorsions.append(distorsion)</span>
<span id="cb55-666"><a href="#cb55-666" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-667"><a href="#cb55-667" aria-hidden="true" tabindex="-1"></a>elbow_plot_df <span class="op">=</span> pd.DataFrame({<span class="st">'num_clusters'</span>:num_clusters, <span class="st">'distorsions'</span>:distorsions})</span>
<span id="cb55-668"><a href="#cb55-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-669"><a href="#cb55-669" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x <span class="op">=</span> <span class="st">'num_clusters'</span>, y <span class="op">=</span> <span class="st">'distorsions'</span>, data <span class="op">=</span> elbow_plot_df)</span>
<span id="cb55-670"><a href="#cb55-670" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-671"><a href="#cb55-671" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-672"><a href="#cb55-672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-673"><a href="#cb55-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-674"><a href="#cb55-674" aria-hidden="true" tabindex="-1"></a>Using all the features sounds not a good idea since the elbow plot has no suggestion for the number of clusters. PCA could enhance our algorithm because it takes into account only those components that have the most variance.</span>
<span id="cb55-675"><a href="#cb55-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-676"><a href="#cb55-676" aria-hidden="true" tabindex="-1"></a><span class="fu">### KMeans with PCA</span></span>
<span id="cb55-677"><a href="#cb55-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-678"><a href="#cb55-678" aria-hidden="true" tabindex="-1"></a><span class="in">```{python KMeans with PCA}</span></span>
<span id="cb55-679"><a href="#cb55-679" aria-hidden="true" tabindex="-1"></a>distorsions <span class="op">=</span> []</span>
<span id="cb55-680"><a href="#cb55-680" aria-hidden="true" tabindex="-1"></a>num_clusters <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2</span>,<span class="dv">10</span>)</span>
<span id="cb55-681"><a href="#cb55-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-682"><a href="#cb55-682" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> num_clusters:</span>
<span id="cb55-683"><a href="#cb55-683" aria-hidden="true" tabindex="-1"></a>    centroids, distorsion <span class="op">=</span> kmeans(transformed_pca, i)</span>
<span id="cb55-684"><a href="#cb55-684" aria-hidden="true" tabindex="-1"></a>    distorsions.append(distorsion)</span>
<span id="cb55-685"><a href="#cb55-685" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-686"><a href="#cb55-686" aria-hidden="true" tabindex="-1"></a>elbow_plot_df <span class="op">=</span> pd.DataFrame({<span class="st">'num_clusters'</span>:num_clusters, <span class="st">'distorsions'</span>:distorsions})</span>
<span id="cb55-687"><a href="#cb55-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-688"><a href="#cb55-688" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x <span class="op">=</span> <span class="st">'num_clusters'</span>, y <span class="op">=</span> <span class="st">'distorsions'</span>, data <span class="op">=</span> elbow_plot_df)</span>
<span id="cb55-689"><a href="#cb55-689" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-690"><a href="#cb55-690" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-691"><a href="#cb55-691" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-692"><a href="#cb55-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-693"><a href="#cb55-693" aria-hidden="true" tabindex="-1"></a>This plot also confirms that 6 clusters is an appropriate number of clusters in our case.</span>
<span id="cb55-694"><a href="#cb55-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-695"><a href="#cb55-695" aria-hidden="true" tabindex="-1"></a><span class="fu"># Question 4 and 5</span></span>
<span id="cb55-696"><a href="#cb55-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-697"><a href="#cb55-697" aria-hidden="true" tabindex="-1"></a><span class="fu">## Names and Characteristics of Doctors Segmentations</span></span>
<span id="cb55-698"><a href="#cb55-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-699"><a href="#cb55-699" aria-hidden="true" tabindex="-1"></a>In this section, each cluster is attempted to be described with the features given in the data.</span>
<span id="cb55-700"><a href="#cb55-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-701"><a href="#cb55-701" aria-hidden="true" tabindex="-1"></a>First things first, let's take a look for one more time to the number of individuals in each cluster.</span>
<span id="cb55-702"><a href="#cb55-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-703"><a href="#cb55-703" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Number of Individuals in each Cluster}</span></span>
<span id="cb55-704"><a href="#cb55-704" aria-hidden="true" tabindex="-1"></a>merged_data.rename(columns <span class="op">=</span> {<span class="st">'hierarchy_clust_pca'</span>:<span class="st">'Cluster Group'</span>}, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb55-705"><a href="#cb55-705" aria-hidden="true" tabindex="-1"></a>cluster_count <span class="op">=</span> merged_data.groupby(<span class="st">'Cluster Group'</span>).size().reset_index()</span>
<span id="cb55-706"><a href="#cb55-706" aria-hidden="true" tabindex="-1"></a>cluster_count.rename(columns <span class="op">=</span> {<span class="dv">0</span>:<span class="st">'Count'</span>}, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb55-707"><a href="#cb55-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-708"><a href="#cb55-708" aria-hidden="true" tabindex="-1"></a>display(cluster_count)</span>
<span id="cb55-709"><a href="#cb55-709" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-710"><a href="#cb55-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-711"><a href="#cb55-711" aria-hidden="true" tabindex="-1"></a>Group 6 has the highest number of individuals followed by group 3 and 2. Group 1 has the lowest population.</span>
<span id="cb55-712"><a href="#cb55-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-713"><a href="#cb55-713" aria-hidden="true" tabindex="-1"></a>Next, due to the importance of customer satisfaction in every business, the following plot shows how satisfaction is distributed among 6 groups.</span>
<span id="cb55-714"><a href="#cb55-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-715"><a href="#cb55-715" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Plot Colors}</span></span>
<span id="cb55-716"><a href="#cb55-716" aria-hidden="true" tabindex="-1"></a>plot_colors <span class="op">=</span> [<span class="st">'#264653'</span>, <span class="st">'#2A9D8F'</span>, <span class="st">'#E9C46A'</span>, <span class="st">'#F4A261'</span>, <span class="st">'#E76F51'</span>]</span>
<span id="cb55-717"><a href="#cb55-717" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-718"><a href="#cb55-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-719"><a href="#cb55-719" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Satisfaction of Clusters}</span></span>
<span id="cb55-720"><a href="#cb55-720" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'Cluster Group'</span>, y <span class="op">=</span> <span class="st">'Satisfaction'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data, color <span class="op">=</span> plot_colors[<span class="dv">0</span>])</span>
<span id="cb55-721"><a href="#cb55-721" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-722"><a href="#cb55-722" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-723"><a href="#cb55-723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-724"><a href="#cb55-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-725"><a href="#cb55-725" aria-hidden="true" tabindex="-1"></a>Doctors in group 3 are more satisfied customers of the company in average and the error bar is relatively low. In the second place, group 6 contains comparitively satisfied doctors. On the other hand, group 6 and group 1 are not very satisfied in average, but the error bars are larger than the others. In group 1 specifically, there are a wide range of satisfaction as the error bar length is considerable.</span>
<span id="cb55-726"><a href="#cb55-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-727"><a href="#cb55-727" aria-hidden="true" tabindex="-1"></a>Experience column can detect which customers have been working with the company longer and which of them have purchased recently.</span>
<span id="cb55-728"><a href="#cb55-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-729"><a href="#cb55-729" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Experience of Clusters}</span></span>
<span id="cb55-730"><a href="#cb55-730" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'Cluster Group'</span>, y <span class="op">=</span> <span class="st">'Experience'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data, color <span class="op">=</span> plot_colors[<span class="dv">1</span>])</span>
<span id="cb55-731"><a href="#cb55-731" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-732"><a href="#cb55-732" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-733"><a href="#cb55-733" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-734"><a href="#cb55-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-735"><a href="#cb55-735" aria-hidden="true" tabindex="-1"></a>Doctors of group 2 have more experience followed by group 1. Differences among other groups are not so strong.</span>
<span id="cb55-736"><a href="#cb55-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-737"><a href="#cb55-737" aria-hidden="true" tabindex="-1"></a>The next two figures show the average of Incident Rate and R Rate (Rework) for each cluster group.</span>
<span id="cb55-738"><a href="#cb55-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-739"><a href="#cb55-739" aria-hidden="true" tabindex="-1"></a>Although Group 1 has the lowest rework rate, other cluster groups have no meaningful difference. Incident rate, however, has a large value for group 2 and 6, with a lower standard deviation for the latter.</span>
<span id="cb55-740"><a href="#cb55-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-741"><a href="#cb55-741" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Incidence rate of Clusters}</span></span>
<span id="cb55-742"><a href="#cb55-742" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'Cluster Group'</span>, y <span class="op">=</span> <span class="st">'Incidence rate'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data, color <span class="op">=</span> plot_colors[<span class="dv">2</span>])</span>
<span id="cb55-743"><a href="#cb55-743" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-744"><a href="#cb55-744" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-745"><a href="#cb55-745" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-746"><a href="#cb55-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-747"><a href="#cb55-747" aria-hidden="true" tabindex="-1"></a><span class="in">```{python R rate of Clusters}</span></span>
<span id="cb55-748"><a href="#cb55-748" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'Cluster Group'</span>, y <span class="op">=</span> <span class="st">'R rate'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data, color <span class="op">=</span> plot_colors[<span class="dv">3</span>])</span>
<span id="cb55-749"><a href="#cb55-749" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-750"><a href="#cb55-750" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-751"><a href="#cb55-751" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-752"><a href="#cb55-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-753"><a href="#cb55-753" aria-hidden="true" tabindex="-1"></a>In the next plot, you can see the average number of purchases in each cluster. Group 3 and 2 have purchased more (group 3 has lower uncertainty) and Group 1, 4, and 5 haven't chosen the company for supply.</span>
<span id="cb55-754"><a href="#cb55-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-755"><a href="#cb55-755" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Last Purchases of Clusters}</span></span>
<span id="cb55-756"><a href="#cb55-756" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'Cluster Group'</span>, y <span class="op">=</span> <span class="st">'last_purchases'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data, color <span class="op">=</span> plot_colors[<span class="dv">4</span>])</span>
<span id="cb55-757"><a href="#cb55-757" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Purchases of Last Year'</span>)</span>
<span id="cb55-758"><a href="#cb55-758" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-759"><a href="#cb55-759" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-760"><a href="#cb55-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-761"><a href="#cb55-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-762"><a href="#cb55-762" aria-hidden="true" tabindex="-1"></a>Also, the average number of settings that customers demanded along their orders matters. Group 2 on average, are more detailed for their order.</span>
<span id="cb55-763"><a href="#cb55-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-764"><a href="#cb55-764" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Total Settings of Clusters}</span></span>
<span id="cb55-765"><a href="#cb55-765" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'Cluster Group'</span>, y <span class="op">=</span> <span class="st">'total_settings'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data, color <span class="op">=</span> plot_colors[<span class="dv">0</span>])</span>
<span id="cb55-766"><a href="#cb55-766" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Settings Demanded'</span>)</span>
<span id="cb55-767"><a href="#cb55-767" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-768"><a href="#cb55-768" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-769"><a href="#cb55-769" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-770"><a href="#cb55-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-771"><a href="#cb55-771" aria-hidden="true" tabindex="-1"></a>Group 2 are complaining more than any other group as the next dot plot shows.</span>
<span id="cb55-772"><a href="#cb55-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-773"><a href="#cb55-773" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Correct Complaints of Clusters}</span></span>
<span id="cb55-774"><a href="#cb55-774" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'Cluster Group'</span>, y <span class="op">=</span> <span class="st">'total_complaints'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data, color <span class="op">=</span> plot_colors[<span class="dv">1</span>])</span>
<span id="cb55-775"><a href="#cb55-775" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Complaints'</span>)</span>
<span id="cb55-776"><a href="#cb55-776" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-777"><a href="#cb55-777" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-778"><a href="#cb55-778" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-779"><a href="#cb55-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-780"><a href="#cb55-780" aria-hidden="true" tabindex="-1"></a>Groups 2 and 3 have had more instructions relatively.</span>
<span id="cb55-781"><a href="#cb55-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-782"><a href="#cb55-782" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Instructions of Clusters}</span></span>
<span id="cb55-783"><a href="#cb55-783" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'Cluster Group'</span>, y <span class="op">=</span> <span class="st">'Instructions'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data, color <span class="op">=</span> plot_colors[<span class="dv">2</span>])</span>
<span id="cb55-784"><a href="#cb55-784" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Instructions'</span>)</span>
<span id="cb55-785"><a href="#cb55-785" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-786"><a href="#cb55-786" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-787"><a href="#cb55-787" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-788"><a href="#cb55-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-789"><a href="#cb55-789" aria-hidden="true" tabindex="-1"></a>Finally, group 2 have placed more orders recently implying they are more interested to buy from the company. In other words, the company should put their energy into luring them. Marketing activities should revolve aroung such customers with their specific characteristics.</span>
<span id="cb55-790"><a href="#cb55-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-791"><a href="#cb55-791" aria-hidden="true" tabindex="-1"></a><span class="in">```{python Total Orders of Clusters}</span></span>
<span id="cb55-792"><a href="#cb55-792" aria-hidden="true" tabindex="-1"></a>sns.catplot(x <span class="op">=</span> <span class="st">'Cluster Group'</span>, y <span class="op">=</span> <span class="st">'total_orders'</span>, kind <span class="op">=</span> <span class="st">'point'</span>, data <span class="op">=</span> merged_data, color <span class="op">=</span> plot_colors[<span class="dv">3</span>])</span>
<span id="cb55-793"><a href="#cb55-793" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Orders'</span>)</span>
<span id="cb55-794"><a href="#cb55-794" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb55-795"><a href="#cb55-795" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb55-796"><a href="#cb55-796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-797"><a href="#cb55-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-798"><a href="#cb55-798" aria-hidden="true" tabindex="-1"></a><span class="fu">## Names of Clusters</span></span>
<span id="cb55-799"><a href="#cb55-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-800"><a href="#cb55-800" aria-hidden="true" tabindex="-1"></a>Group 1 haven't purchased that much compared to others and their satisfaction are so volatile meaning that some of doctors have been delighted and some have been unsatisfied. Their incident rate and rework rate are low, which is a cost privilege for the company. Their size is not that significant though.</span>
<span id="cb55-801"><a href="#cb55-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-802"><a href="#cb55-802" aria-hidden="true" tabindex="-1"></a>**Group 1 is named "Easy-goings Doctors"**</span>
<span id="cb55-803"><a href="#cb55-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-804"><a href="#cb55-804" aria-hidden="true" tabindex="-1"></a>Group 2 have more experience with the products of the company. However, their incident rate and rework are high. These customers have already purchased last year almost 13 times. They have complained more than others partially because of their high number of purchases. The instructions they need are also more significant. Most orders in this year comes from group 2.</span>
<span id="cb55-805"><a href="#cb55-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-806"><a href="#cb55-806" aria-hidden="true" tabindex="-1"></a>**Group 2 is named "Picking Loyal Doctors"**</span>
<span id="cb55-807"><a href="#cb55-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-808"><a href="#cb55-808" aria-hidden="true" tabindex="-1"></a>Group 3 consist of customers with the most purchases from last year, but their orders for this year has dropped to almost zero. They've been more satisfied group with past experience. They didn't complain of their purchases, so it's a mystery why they've stopped buying from the company. More investigation is required in order to explain the reasons underlying their reluctance.</span>
<span id="cb55-809"><a href="#cb55-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-810"><a href="#cb55-810" aria-hidden="true" tabindex="-1"></a>**Group 3 is named "Mysterious Doctors"**</span>
<span id="cb55-811"><a href="#cb55-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-812"><a href="#cb55-812" aria-hidden="true" tabindex="-1"></a>Group 4 contains doctors who are happy with their previous purchases, but in general, they don't have much experience and their purchases in the last year was trivial. This group has some orders this year.</span>
<span id="cb55-813"><a href="#cb55-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-814"><a href="#cb55-814" aria-hidden="true" tabindex="-1"></a>**Group 4 is named "Curious Doctors"**</span>
<span id="cb55-815"><a href="#cb55-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-816"><a href="#cb55-816" aria-hidden="true" tabindex="-1"></a>Group 5 doctors have the least experience with the lowest satisfaction rate. They haven't bought last year so we are almost confident we can ignore this segment of doctors. The number of doctors in this group is negligible too.</span>
<span id="cb55-817"><a href="#cb55-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-818"><a href="#cb55-818" aria-hidden="true" tabindex="-1"></a>**Group 5 is named "Ignored Doctors"**</span>
<span id="cb55-819"><a href="#cb55-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-820"><a href="#cb55-820" aria-hidden="true" tabindex="-1"></a>Group 6 include doctors who are the happiest with their previous purchases after group 3. Instructions in this group is low comparing to others, but their incident rate is rather high. Doctors in this group have placed some orders too. The majority of doctors have been categorized in this group.</span>
<span id="cb55-821"><a href="#cb55-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-822"><a href="#cb55-822" aria-hidden="true" tabindex="-1"></a>**Group 6 is named "Promising Doctors"**</span>
<span id="cb55-823"><a href="#cb55-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-824"><a href="#cb55-824" aria-hidden="true" tabindex="-1"></a><span class="fu">## Targeted Groups</span></span>
<span id="cb55-825"><a href="#cb55-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-826"><a href="#cb55-826" aria-hidden="true" tabindex="-1"></a>In conclusion, the company should focus on group 6 with the intention of converting them into regular customers. Group 2 includes the most royal customers whose satisfaction is a priority. Group 3 is also important regarding the fact that they can be transformed from inactive customers to active ones. Groups 1 and 4 can be treated with less attention and group 5 should be left out.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>